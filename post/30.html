<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Citrus327</title><meta name="description" content="Citrus327 Blog"/><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/blog/_next/static/css/82f1db8675d0cc14.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/82f1db8675d0cc14.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/f9a979fa4ea39b64.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/f9a979fa4ea39b64.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/blog/_next/static/chunks/webpack-4d5208940e01a3dc.js" defer=""></script><script src="/blog/_next/static/chunks/framework-30d8ee4f291f716e.js" defer=""></script><script src="/blog/_next/static/chunks/main-beaf44c65568c517.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-05baf97dde41af4f.js" defer=""></script><script src="/blog/_next/static/chunks/995-6cd8bd0d5e7ab91e.js" defer=""></script><script src="/blog/_next/static/chunks/pages/post/%5Bid%5D-10e4f1d120841a90.js" defer=""></script><script src="/blog/_next/static/uJDcxFVw8GAE4MO-JELhM/_buildManifest.js" defer=""></script><script src="/blog/_next/static/uJDcxFVw8GAE4MO-JELhM/_ssgManifest.js" defer=""></script><script src="/blog/_next/static/uJDcxFVw8GAE4MO-JELhM/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_container__KdNo5"><header class="Layout_header__TY1Ur"><div class="Avatar_avatar__Wqsgs"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="Avatar_img__fPm7S" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://avatars.githubusercontent.com/u/17166940?v=4 1x, https://avatars.githubusercontent.com/u/17166940?v=4 2x" src="https://avatars.githubusercontent.com/u/17166940?v=4" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="Avatar_img__fPm7S" loading="lazy"/></noscript></span><div class="Avatar_username__94Fmm">citrus327</div></div><div class="Navbar_navbar__dE_dF"><nav class="Navbar_nav__lgcdH"><a href="/blog">Home</a></nav><nav class="Navbar_nav__lgcdH"><a href="/blog/posts">Posts</a></nav></div></header><main class="Layout_main__CO5d2"><div class="markdown-body scroller"><blockquote>
<p dir="auto">背景: 使用<code class="notranslate">react-typescript-docgen</code>直接去parse我写的一个组件无效。</p>
</blockquote>
<p dir="auto">直接上代码</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="import React from 'react'

export interface ButtonProps {
  children?: React.ReactNode
  /** prop1 description */
  onClick: () =&gt; void
}

const Button: React.FunctionComponent&lt;ButtonProps&gt; = (props: ButtonProps) =&gt; {
  return &lt;button&gt;123&lt;/button&gt;
}

export default Button"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-v">React</span> <span class="pl-k">from</span> <span class="pl-s">'react'</span>

<span class="pl-k">export</span> <span class="pl-s1">interface</span> <span class="pl-v">ButtonProps</span> <span class="pl-kos">{</span>
  <span class="pl-s1">children</span>?<span class="pl-s1"></span>: <span class="pl-v">React</span><span class="pl-kos">.</span><span class="pl-c1">ReactNode</span>
  <span class="pl-c">/** prop1 description */</span>
  onClick: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-k">void</span>
<span class="pl-kos">}</span>

<span class="pl-k">const</span> <span class="pl-v">Button</span>: <span class="pl-v">React</span><span class="pl-kos">.</span><span class="pl-c1">FunctionComponent</span><span class="pl-c1">&lt;</span><span class="pl-v">ButtonProps</span><span class="pl-c1">&gt;</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-s1">props</span>: <span class="pl-v">ButtonProps</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
  <span class="pl-k">return</span> <span class="pl-c1">&lt;</span><span class="pl-ent">button</span><span class="pl-c1">&gt;</span>123<span class="pl-c1">&lt;</span><span class="pl-c1">/</span><span class="pl-ent">button</span><span class="pl-c1">&gt;</span>
<span class="pl-kos">}</span>

<span class="pl-k">export</span> <span class="pl-k">default</span> <span class="pl-v">Button</span></pre></div>
<p dir="auto">parser代码</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="const docgen = require(&quot;react-docgen-typescript&quot;);

const options = {
  savePropValueAsString: true,
};
// Parse a file for docgen info
const result = docgen.parse(&quot;./test/Button.tsx&quot;, options);

console.log(result);

"><pre class="notranslate"><span class="pl-k">const</span> <span class="pl-s1">docgen</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">"react-docgen-typescript"</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">options</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
  <span class="pl-c1">savePropValueAsString</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>
<span class="pl-c">// Parse a file for docgen info</span>
<span class="pl-k">const</span> <span class="pl-s1">result</span> <span class="pl-c1">=</span> <span class="pl-s1">docgen</span><span class="pl-kos">.</span><span class="pl-en">parse</span><span class="pl-kos">(</span><span class="pl-s">"./test/Button.tsx"</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">result</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
</pre></div>
<p dir="auto">从源码中找到了getComponentInfo的代码</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="// node_modules/react-docgen-typescript/lib/parser.js
Parser.prototype.getComponentInfo = function (exp, source, componentNameResolver, customComponentTypes) {
  // ...
  var defaultComponentTypes = [
    '__function',
    'StatelessComponent',
    'Stateless',
    'StyledComponentClass',
    'StyledComponent',
    'FunctionComponent',
    'ForwardRefExoticComponent'
  ];
  var supportedComponentTypes = __spreadArray(__spreadArray([], defaultComponentTypes), customComponentTypes);
  // ...
}"><pre class="notranslate"><span class="pl-c">// node_modules/react-docgen-typescript/lib/parser.js</span>
<span class="pl-v">Parser</span><span class="pl-kos">.</span><span class="pl-c1">prototype</span><span class="pl-kos">.</span><span class="pl-en">getComponentInfo</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">exp</span><span class="pl-kos">,</span> <span class="pl-s1">source</span><span class="pl-kos">,</span> <span class="pl-s1">componentNameResolver</span><span class="pl-kos">,</span> <span class="pl-s1">customComponentTypes</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
  <span class="pl-c">// ...</span>
  <span class="pl-k">var</span> <span class="pl-s1">defaultComponentTypes</span> <span class="pl-c1">=</span> <span class="pl-kos">[</span>
    <span class="pl-s">'__function'</span><span class="pl-kos">,</span>
    <span class="pl-s">'StatelessComponent'</span><span class="pl-kos">,</span>
    <span class="pl-s">'Stateless'</span><span class="pl-kos">,</span>
    <span class="pl-s">'StyledComponentClass'</span><span class="pl-kos">,</span>
    <span class="pl-s">'StyledComponent'</span><span class="pl-kos">,</span>
    <span class="pl-s">'FunctionComponent'</span><span class="pl-kos">,</span>
    <span class="pl-s">'ForwardRefExoticComponent'</span>
  <span class="pl-kos">]</span><span class="pl-kos">;</span>
  <span class="pl-k">var</span> <span class="pl-s1">supportedComponentTypes</span> <span class="pl-c1">=</span> <span class="pl-en">__spreadArray</span><span class="pl-kos">(</span><span class="pl-en">__spreadArray</span><span class="pl-kos">(</span><span class="pl-kos">[</span><span class="pl-kos">]</span><span class="pl-kos">,</span> <span class="pl-s1">defaultComponentTypes</span><span class="pl-kos">)</span><span class="pl-kos">,</span> <span class="pl-s1">customComponentTypes</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-c">// ...</span>
<span class="pl-kos">}</span></pre></div>
<p dir="auto">发现这里默认的<code class="notranslate">componentTypes</code>只有 <code class="notranslate">FunctionComponent</code> ，没有 <code class="notranslate">React.FunctionComponent </code>, 于是将代码改成了<code class="notranslate">import { FunctionComponent } from 'react'</code> 果然可以了！</p>
<p dir="auto">我第一反应是这作者有点啥，为啥会做这种约定，我更倾向写<code class="notranslate">React.FunctionComponent</code>的，虽然累赘但是表意很清晰。</p>
<p dir="auto">不过紧跟着发现是可以通过customComponentTypes这个文档上压根没有的属性进行额外拓展，于是在使用options去拓展了customComponentTypes这个设置。</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="const docgen = require(&quot;react-docgen-typescript&quot;);

const options = {
  customComponentTypes: [&quot;React.FunctionComponent&quot;],
};

// Parse a file for docgen info
const result = docgen.parse(&quot;./test/Button.tsx&quot;, options);

console.log(result);
"><pre class="notranslate"><span class="pl-k">const</span> <span class="pl-s1">docgen</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">"react-docgen-typescript"</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">options</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
  <span class="pl-c1">customComponentTypes</span>: <span class="pl-kos">[</span><span class="pl-s">"React.FunctionComponent"</span><span class="pl-kos">]</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-c">// Parse a file for docgen info</span>
<span class="pl-k">const</span> <span class="pl-s1">result</span> <span class="pl-c1">=</span> <span class="pl-s1">docgen</span><span class="pl-kos">.</span><span class="pl-en">parse</span><span class="pl-kos">(</span><span class="pl-s">"./test/Button.tsx"</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">result</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<p dir="auto">通过debug发现，这个<code class="notranslate">customComponentTypes</code>确实被成功使用了，但是问题还是没有解决。</p>
<p dir="auto">我又去重新阅读了官方的文档，发现他们在ts中使用<code class="notranslate">react</code>，都是<code class="notranslate">import * as React from 'react'</code></p>
<p dir="auto">我就将我的demo改成了</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="import * as React from 'react' // 这行

export interface ButtonProps {
  children?: React.ReactNode
  /** prop1 description */
  onClick: () =&gt; void
}

const Button: React.FunctionComponent&lt;ButtonProps&gt; = (props: ButtonProps) =&gt; {
  return &lt;button&gt;123&lt;/button&gt;
}

export default Button"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-c1">*</span> <span class="pl-k">as</span> <span class="pl-v">React</span> <span class="pl-k">from</span> <span class="pl-s">'react'</span> <span class="pl-c">// 这行</span>

<span class="pl-k">export</span> <span class="pl-s1">interface</span> <span class="pl-v">ButtonProps</span> <span class="pl-kos">{</span>
  <span class="pl-s1">children</span>?<span class="pl-s1"></span>: <span class="pl-v">React</span><span class="pl-kos">.</span><span class="pl-c1">ReactNode</span>
  <span class="pl-c">/** prop1 description */</span>
  onClick: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-k">void</span>
<span class="pl-kos">}</span>

<span class="pl-k">const</span> <span class="pl-v">Button</span>: <span class="pl-v">React</span><span class="pl-kos">.</span><span class="pl-c1">FunctionComponent</span><span class="pl-c1">&lt;</span><span class="pl-v">ButtonProps</span><span class="pl-c1">&gt;</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-s1">props</span>: <span class="pl-v">ButtonProps</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
  <span class="pl-k">return</span> <span class="pl-c1">&lt;</span><span class="pl-ent">button</span><span class="pl-c1">&gt;</span>123<span class="pl-c1">&lt;</span><span class="pl-c1">/</span><span class="pl-ent">button</span><span class="pl-c1">&gt;</span>
<span class="pl-kos">}</span>

<span class="pl-k">export</span> <span class="pl-k">default</span> <span class="pl-v">Button</span></pre></div>
<p dir="auto">去掉了<code class="notranslate">customComponentTypes</code>设置，重新跑一遍，组件被成功parse了。</p>
<p dir="auto">这其实问题就转变成了<code class="notranslate">import React from 'react'</code> 和 <code class="notranslate">import * as React from 'react'</code>的问题。</p>
<p dir="auto">想想其实我的运行环境是node环境，也就是cjs.</p>
<p dir="auto">React本身编译后的cjs包，就是没有default属性的，所以在ts环境下需要加入<code class="notranslate">{esModuleInterop: true}</code>。</p>
<p dir="auto">通过增加esModuleInterop为true，问题成功得到解决。</p>
<p dir="auto">参考：</p>
<ul dir="auto">
<li><a href="https://stackoverflow.com/questions/54585763/what-is-the-difference-between-import-as-react-from-react-vs-import-react-fr" rel="nofollow">https://stackoverflow.com/questions/54585763/what-is-the-difference-between-import-as-react-from-react-vs-import-react-fr</a></li>
<li><a href="https://github.com/styleguidist/react-docgen-typescript">https://github.com/styleguidist/react-docgen-typescript</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/148081795" rel="nofollow">https://zhuanlan.zhihu.com/p/148081795</a></li>
</ul></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"html":"\u003cblockquote\u003e\n\u003cp dir=\"auto\"\u003e背景: 使用\u003ccode class=\"notranslate\"\u003ereact-typescript-docgen\u003c/code\u003e直接去parse我写的一个组件无效。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp dir=\"auto\"\u003e直接上代码\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"import React from 'react'\n\nexport interface ButtonProps {\n  children?: React.ReactNode\n  /** prop1 description */\n  onClick: () =\u0026gt; void\n}\n\nconst Button: React.FunctionComponent\u0026lt;ButtonProps\u0026gt; = (props: ButtonProps) =\u0026gt; {\n  return \u0026lt;button\u0026gt;123\u0026lt;/button\u0026gt;\n}\n\nexport default Button\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eReact\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e'react'\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003eexport\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003einterface\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eButtonProps\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-s1\"\u003echildren\u003c/span\u003e?\u003cspan class=\"pl-s1\"\u003e\u003c/span\u003e: \u003cspan class=\"pl-v\"\u003eReact\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eReactNode\u003c/span\u003e\n  \u003cspan class=\"pl-c\"\u003e/** prop1 description */\u003c/span\u003e\n  onClick: \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-k\"\u003evoid\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eButton\u003c/span\u003e: \u003cspan class=\"pl-v\"\u003eReact\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eFunctionComponent\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"pl-v\"\u003eButtonProps\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eprops\u003c/span\u003e: \u003cspan class=\"pl-v\"\u003eButtonProps\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"pl-ent\"\u003ebutton\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e\u0026gt;\u003c/span\u003e123\u003cspan class=\"pl-c1\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e/\u003c/span\u003e\u003cspan class=\"pl-ent\"\u003ebutton\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003eexport\u003c/span\u003e \u003cspan class=\"pl-k\"\u003edefault\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eButton\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003eparser代码\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"const docgen = require(\u0026quot;react-docgen-typescript\u0026quot;);\n\nconst options = {\n  savePropValueAsString: true,\n};\n// Parse a file for docgen info\nconst result = docgen.parse(\u0026quot;./test/Button.tsx\u0026quot;, options);\n\nconsole.log(result);\n\n\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003edocgen\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-en\"\u003erequire\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e\"react-docgen-typescript\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eoptions\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003esavePropValueAsString\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003etrue\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003cspan class=\"pl-c\"\u003e// Parse a file for docgen info\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eresult\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003edocgen\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eparse\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e\"./test/Button.tsx\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eoptions\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"pl-smi\"\u003econsole\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003elog\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eresult\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e从源码中找到了getComponentInfo的代码\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"// node_modules/react-docgen-typescript/lib/parser.js\nParser.prototype.getComponentInfo = function (exp, source, componentNameResolver, customComponentTypes) {\n  // ...\n  var defaultComponentTypes = [\n    '__function',\n    'StatelessComponent',\n    'Stateless',\n    'StyledComponentClass',\n    'StyledComponent',\n    'FunctionComponent',\n    'ForwardRefExoticComponent'\n  ];\n  var supportedComponentTypes = __spreadArray(__spreadArray([], defaultComponentTypes), customComponentTypes);\n  // ...\n}\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-c\"\u003e// node_modules/react-docgen-typescript/lib/parser.js\u003c/span\u003e\n\u003cspan class=\"pl-v\"\u003eParser\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eprototype\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003egetComponentInfo\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eexp\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003esource\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003ecomponentNameResolver\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003ecustomComponentTypes\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c\"\u003e// ...\u003c/span\u003e\n  \u003cspan class=\"pl-k\"\u003evar\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003edefaultComponentTypes\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"pl-s\"\u003e'__function'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-s\"\u003e'StatelessComponent'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-s\"\u003e'Stateless'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-s\"\u003e'StyledComponentClass'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-s\"\u003e'StyledComponent'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-s\"\u003e'FunctionComponent'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-s\"\u003e'ForwardRefExoticComponent'\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"pl-k\"\u003evar\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003esupportedComponentTypes\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-en\"\u003e__spreadArray\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-en\"\u003e__spreadArray\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003edefaultComponentTypes\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003ecustomComponentTypes\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"pl-c\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e发现这里默认的\u003ccode class=\"notranslate\"\u003ecomponentTypes\u003c/code\u003e只有 \u003ccode class=\"notranslate\"\u003eFunctionComponent\u003c/code\u003e ，没有 \u003ccode class=\"notranslate\"\u003eReact.FunctionComponent \u003c/code\u003e, 于是将代码改成了\u003ccode class=\"notranslate\"\u003eimport { FunctionComponent } from 'react'\u003c/code\u003e 果然可以了！\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e我第一反应是这作者有点啥，为啥会做这种约定，我更倾向写\u003ccode class=\"notranslate\"\u003eReact.FunctionComponent\u003c/code\u003e的，虽然累赘但是表意很清晰。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e不过紧跟着发现是可以通过customComponentTypes这个文档上压根没有的属性进行额外拓展，于是在使用options去拓展了customComponentTypes这个设置。\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"const docgen = require(\u0026quot;react-docgen-typescript\u0026quot;);\n\nconst options = {\n  customComponentTypes: [\u0026quot;React.FunctionComponent\u0026quot;],\n};\n\n// Parse a file for docgen info\nconst result = docgen.parse(\u0026quot;./test/Button.tsx\u0026quot;, options);\n\nconsole.log(result);\n\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003edocgen\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-en\"\u003erequire\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e\"react-docgen-typescript\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eoptions\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003ecustomComponentTypes\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e\"React.FunctionComponent\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"pl-c\"\u003e// Parse a file for docgen info\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eresult\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003edocgen\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eparse\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e\"./test/Button.tsx\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eoptions\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"pl-smi\"\u003econsole\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003elog\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eresult\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e通过debug发现，这个\u003ccode class=\"notranslate\"\u003ecustomComponentTypes\u003c/code\u003e确实被成功使用了，但是问题还是没有解决。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e我又去重新阅读了官方的文档，发现他们在ts中使用\u003ccode class=\"notranslate\"\u003ereact\u003c/code\u003e，都是\u003ccode class=\"notranslate\"\u003eimport * as React from 'react'\u003c/code\u003e\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e我就将我的demo改成了\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"import * as React from 'react' // 这行\n\nexport interface ButtonProps {\n  children?: React.ReactNode\n  /** prop1 description */\n  onClick: () =\u0026gt; void\n}\n\nconst Button: React.FunctionComponent\u0026lt;ButtonProps\u0026gt; = (props: ButtonProps) =\u0026gt; {\n  return \u0026lt;button\u0026gt;123\u0026lt;/button\u0026gt;\n}\n\nexport default Button\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e*\u003c/span\u003e \u003cspan class=\"pl-k\"\u003eas\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eReact\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e'react'\u003c/span\u003e \u003cspan class=\"pl-c\"\u003e// 这行\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003eexport\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003einterface\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eButtonProps\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-s1\"\u003echildren\u003c/span\u003e?\u003cspan class=\"pl-s1\"\u003e\u003c/span\u003e: \u003cspan class=\"pl-v\"\u003eReact\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eReactNode\u003c/span\u003e\n  \u003cspan class=\"pl-c\"\u003e/** prop1 description */\u003c/span\u003e\n  onClick: \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-k\"\u003evoid\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eButton\u003c/span\u003e: \u003cspan class=\"pl-v\"\u003eReact\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eFunctionComponent\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"pl-v\"\u003eButtonProps\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eprops\u003c/span\u003e: \u003cspan class=\"pl-v\"\u003eButtonProps\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"pl-ent\"\u003ebutton\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e\u0026gt;\u003c/span\u003e123\u003cspan class=\"pl-c1\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e/\u003c/span\u003e\u003cspan class=\"pl-ent\"\u003ebutton\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003eexport\u003c/span\u003e \u003cspan class=\"pl-k\"\u003edefault\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eButton\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e去掉了\u003ccode class=\"notranslate\"\u003ecustomComponentTypes\u003c/code\u003e设置，重新跑一遍，组件被成功parse了。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e这其实问题就转变成了\u003ccode class=\"notranslate\"\u003eimport React from 'react'\u003c/code\u003e 和 \u003ccode class=\"notranslate\"\u003eimport * as React from 'react'\u003c/code\u003e的问题。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e想想其实我的运行环境是node环境，也就是cjs.\u003c/p\u003e\n\u003cp dir=\"auto\"\u003eReact本身编译后的cjs包，就是没有default属性的，所以在ts环境下需要加入\u003ccode class=\"notranslate\"\u003e{esModuleInterop: true}\u003c/code\u003e。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e通过增加esModuleInterop为true，问题成功得到解决。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e参考：\u003c/p\u003e\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/54585763/what-is-the-difference-between-import-as-react-from-react-vs-import-react-fr\" rel=\"nofollow\"\u003ehttps://stackoverflow.com/questions/54585763/what-is-the-difference-between-import-as-react-from-react-vs-import-react-fr\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/styleguidist/react-docgen-typescript\"\u003ehttps://github.com/styleguidist/react-docgen-typescript\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/148081795\" rel=\"nofollow\"\u003ehttps://zhuanlan.zhihu.com/p/148081795\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"},"__N_SSG":true},"page":"/post/[id]","query":{"id":"30"},"buildId":"uJDcxFVw8GAE4MO-JELhM","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>