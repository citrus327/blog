<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Minimal Life</title><meta name="description" content="Minimal Life Blog"/><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/blog/_next/static/css/6db3845f9f3a867b.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/6db3845f9f3a867b.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/452f28fbf231f2d9.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/452f28fbf231f2d9.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/blog/_next/static/chunks/webpack-4d5208940e01a3dc.js" defer=""></script><script src="/blog/_next/static/chunks/framework-00b57966872fc495.js" defer=""></script><script src="/blog/_next/static/chunks/main-04fa69cd18d105e9.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-f55443f2448c8e66.js" defer=""></script><script src="/blog/_next/static/chunks/247-b84c2316c963d09c.js" defer=""></script><script src="/blog/_next/static/chunks/pages/post/%5Bid%5D-5f7ac47925745e56.js" defer=""></script><script src="/blog/_next/static/rBbusu2MNuhg6PTCw5Tx9/_buildManifest.js" defer=""></script><script src="/blog/_next/static/rBbusu2MNuhg6PTCw5Tx9/_ssgManifest.js" defer=""></script><script src="/blog/_next/static/rBbusu2MNuhg6PTCw5Tx9/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_container__KdNo5"><header class="Layout_header__TY1Ur"><div class="Avatar_avatar__Wqsgs"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="Avatar_img__fPm7S" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://avatars.githubusercontent.com/u/17166940?v=4 1x, https://avatars.githubusercontent.com/u/17166940?v=4 2x" src="https://avatars.githubusercontent.com/u/17166940?v=4" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="Avatar_img__fPm7S" loading="lazy"/></noscript></span><div class="Avatar_username__94Fmm">phshy0607</div></div><div class="Navbar_navbar__dE_dF"><nav class="Navbar_nav__lgcdH"><a href="/blog">Home</a></nav><nav class="Navbar_nav__lgcdH"><a href="/blog/posts">Posts</a></nav></div></header><main class="Layout_main__CO5d2"><div class="markdown-body"><h1 dir="auto">记一次Electron开发全过程</h1>
<p dir="auto">[[toc]]</p>
<h2 dir="auto">引子</h2>
<p dir="auto">有一个需要开发PC桌面端的需求。日常中使用的网易云音乐，Twitch client等都属于electron的产品。<br>
Electron对于前端开发来说上手非常简单，虽早有耳闻electron的强大，也看过一些文档和基本实现，但是没有完整的搭建、开发和维护过一个electron项目。借这个机会，熟悉一下electron技术栈，也写下本文，做一次技术积累。</p>
<h2 dir="auto">Electron</h2>
<p dir="auto">Electron分为Main进程（主进程）和Renderer进程（渲染进程）</p>
<p dir="auto">主进程为Node.js服务端环境，负责数据库处理，文件处理等</p>
<p dir="auto">渲染进程为浏览器环境</p>
<p dir="auto">主进程会将渲染进程的html，创建window，挂载html运行</p>
<p dir="auto">主进程与渲染进程通过electron包提供的ipcMain和ipcRenderer进行进程通讯。其实就是一个EventEmitter，发布订阅模式。</p>
<h2 dir="auto">项目搭建</h2>
<h3 dir="auto">起步</h3>
<p dir="auto">项目开始基本跟着首页的<a href="https://electronjs.org/docs/tutorial/development-environment#setting-up-windows" rel="nofollow">文档</a>一步步走。</p>
<h3 dir="auto">脚手架</h3>
<p dir="auto">直到<a href="https://electronjs.org/docs/tutorial/boilerplates-and-clis" rel="nofollow">Boilerplates and CLIs</a>这一章。这一章开头也提到了说Electron只是提供了一种基于chromium渲染的桌面端包装而已。对于如何开发、构建、打包等是"unopinionated"。这一章中提到了很多的boilerplate和CLI的方案。</p>
<ol dir="auto">
<li><code class="notranslate">electron-forge</code></li>
<li><code class="notranslate">electron-builder</code></li>
<li><code class="notranslate">electron-react-boilerplate</code></li>
</ol>
<p dir="auto">前两者是比较基本的脚手架。不限制renderer部分选型。<code class="notranslate">electron-react-boilerplate</code>这个从名字看就基本限定死React了。由于时间紧迫，React的水平也确实有限。只能在前两者里挑选。</p>
<p dir="auto">对于前两个脚手架，我选的是star数较多的electron-builder，时间有限，仅能基于star数选型了。</p>
<h3 dir="auto">electron-builder</h3>
<p dir="auto">使用<code class="notranslate">yarn add electron-builder --dev</code>安装。同时electron-builder本身也提供了一些<a href="https://www.electron.build/#boilerplates" rel="nofollow">模板项目</a>供快速开发参考。</p>
<p dir="auto">这里的我使用<a href="https://nklayman.github.io/vue-cli-plugin-electron-builder/" rel="nofollow">vue-cli-plugin-electron-builder</a>进行项目搭建。这个是基于Vue CLI3的插件。关于Vue CLI3的安装和插件的安装在此不做赘述。</p>
<h3 dir="auto">vue-cli-plugin-electron-builder插件配置</h3>
<p dir="auto">由于这个插件是Vue CLI的插件，那配置文件理所应当在vue.config.js内。<br>
贴上我目前的项目配置：</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="module.exports = {
  pluginOptions: {
    electronBuilder: {
      builderOptions: {
        &quot;appId&quot;: &quot;com.example.app&quot;,
        &quot;productName&quot;: &quot;test-app&quot;,
        directories: {
          buildResources: './build',
          output: &quot;./dist&quot;
        },
        &quot;win&quot;:{//win相关配置
          &quot;icon&quot;:&quot;./build/icon.png&quot;,//图标，当前图标在根目录下，注意这里有两个坑
          &quot;target&quot;: [
            {
              &quot;target&quot;: &quot;nsis&quot;,//利用nsis制作安装程序,
              &quot;arch&quot;: [
                &quot;x64&quot;,//64位
                &quot;ia32&quot;//32位
              ]
            }
          ],
        },
        &quot;nsis&quot;: {
          &quot;allowToChangeInstallationDirectory&quot;: true,
          oneClick: false,
        }
      }
    }
  }
}"><pre><span class="pl-smi">module</span><span class="pl-kos">.</span><span class="pl-c1">exports</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
  <span class="pl-c1">pluginOptions</span>: <span class="pl-kos">{</span>
    <span class="pl-c1">electronBuilder</span>: <span class="pl-kos">{</span>
      <span class="pl-c1">builderOptions</span>: <span class="pl-kos">{</span>
        <span class="pl-s">"appId"</span>: <span class="pl-s">"com.example.app"</span><span class="pl-kos">,</span>
        <span class="pl-s">"productName"</span>: <span class="pl-s">"test-app"</span><span class="pl-kos">,</span>
        <span class="pl-c1">directories</span>: <span class="pl-kos">{</span>
          <span class="pl-c1">buildResources</span>: <span class="pl-s">'./build'</span><span class="pl-kos">,</span>
          <span class="pl-c1">output</span>: <span class="pl-s">"./dist"</span>
        <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-s">"win"</span>:<span class="pl-kos">{</span><span class="pl-c">//win相关配置</span>
          <span class="pl-s">"icon"</span>:<span class="pl-s">"./build/icon.png"</span><span class="pl-kos">,</span><span class="pl-c">//图标，当前图标在根目录下，注意这里有两个坑</span>
          <span class="pl-s">"target"</span>: <span class="pl-kos">[</span>
            <span class="pl-kos">{</span>
              <span class="pl-s">"target"</span>: <span class="pl-s">"nsis"</span><span class="pl-kos">,</span><span class="pl-c">//利用nsis制作安装程序,</span>
              <span class="pl-s">"arch"</span>: <span class="pl-kos">[</span>
                <span class="pl-s">"x64"</span><span class="pl-kos">,</span><span class="pl-c">//64位</span>
                <span class="pl-s">"ia32"</span><span class="pl-c">//32位</span>
              <span class="pl-kos">]</span>
            <span class="pl-kos">}</span>
          <span class="pl-kos">]</span><span class="pl-kos">,</span>
        <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-s">"nsis"</span>: <span class="pl-kos">{</span>
          <span class="pl-s">"allowToChangeInstallationDirectory"</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
          <span class="pl-c1">oneClick</span>: <span class="pl-c1">false</span><span class="pl-kos">,</span>
        <span class="pl-kos">}</span>
      <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
  <span class="pl-kos">}</span>
<span class="pl-kos">}</span></pre></div>
<h2 dir="auto">项目结构</h2>
<ol dir="auto">
<li>build文件夹<br>
存放�打包需要的文件，例如icon等</li>
<li>public文件夹
<ul dir="auto">
<li>静态文件夹</li>
<li>包含渲染进程favcon.ico,index.html等静态文件</li>
</ul>
</li>
<li>src文件夹
<ul dir="auto">
<li>项目代码</li>
<li>-assets: 渲染进程静态文件夹</li>
<li>-biz: 主进程业务代码</li>
<li>-components: Vue.js组件</li>
<li>-plugins: Vue.js插件</li>
<li>-router: Vue-router</li>
<li>-store: Vuex</li>
<li>-views: Vue.js主视图</li>
<li>background.js: 主进程入口</li>
<li>main.js 渲染进程入口</li>
</ul>
</li>
<li>vue.config.js
<ul dir="auto">
<li>vue-cli3的配置文件</li>
</ul>
</li>
</ol>
<h2 dir="auto">主进程与渲染进程通讯</h2>
<p dir="auto">由于electron是一个unopinioned工具，他仅仅提供了进程通讯的方式，而对于如何组织通讯代码，如何封装API是没有一个最优解的。在这我会放出我对于进程通讯的二次封装。</p>
<h3 dir="auto">概念描述</h3>
<p dir="auto">首先定义几个概念</p>
<ol dir="auto">
<li>API
<ul dir="auto">
<li>应用程序接口。</li>
<li>这里的API是给调用方使用的，也就是渲染进程。</li>
</ul>
</li>
<li>Payload Type
<ul dir="auto">
<li>荷载类型。</li>
<li>定义业务类型（事件类型），其实也就是潜在的定义了业务入参和负责业务的具体描述。</li>
</ul>
</li>
<li>Routes
<ul dir="auto">
<li>路由。</li>
<li>分发绑定业务句柄和业务类型。</li>
</ul>
</li>
<li>Services
<ul dir="auto">
<li>服务。</li>
<li>纯净的业务处理，会涉及业务数据处理，db操作等。</li>
</ul>
</li>
</ol>
<h3 dir="auto">路由与业务绑定</h3>
<p dir="auto">先放出Payload Type的定义</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="const PAYLOAD_TYPES = Object.freeze({
  FETCH_FULL_DATA: 'FETCH_FULL_DATA',
  FETCH_DROPDOWN_LIST: 'FETCH_DROPDOWN_LIST',
  UPDATE_CELL: 'UPDATE_CELL',
  SORT_SHEET: 'SORT_SHEET',
  VALIDATE_SHEET: 'VALIDATE_SHEET',
  CALCULATE_SHEET: 'CALCULATE_SHEET',
  FETCH_INITIAL_DATA: 'FETCH_INITIAL_DATA',
  DELETE_ROW: 'DELETE_ROW'
})"><pre><span class="pl-k">const</span> <span class="pl-c1">PAYLOAD_TYPES</span> <span class="pl-c1">=</span> <span class="pl-v">Object</span><span class="pl-kos">.</span><span class="pl-en">freeze</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
  <span class="pl-c1">FETCH_FULL_DATA</span>: <span class="pl-s">'FETCH_FULL_DATA'</span><span class="pl-kos">,</span>
  <span class="pl-c1">FETCH_DROPDOWN_LIST</span>: <span class="pl-s">'FETCH_DROPDOWN_LIST'</span><span class="pl-kos">,</span>
  <span class="pl-c1">UPDATE_CELL</span>: <span class="pl-s">'UPDATE_CELL'</span><span class="pl-kos">,</span>
  <span class="pl-c1">SORT_SHEET</span>: <span class="pl-s">'SORT_SHEET'</span><span class="pl-kos">,</span>
  <span class="pl-c1">VALIDATE_SHEET</span>: <span class="pl-s">'VALIDATE_SHEET'</span><span class="pl-kos">,</span>
  <span class="pl-c1">CALCULATE_SHEET</span>: <span class="pl-s">'CALCULATE_SHEET'</span><span class="pl-kos">,</span>
  <span class="pl-c1">FETCH_INITIAL_DATA</span>: <span class="pl-s">'FETCH_INITIAL_DATA'</span><span class="pl-kos">,</span>
  <span class="pl-c1">DELETE_ROW</span>: <span class="pl-s">'DELETE_ROW'</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span></pre></div>
<p dir="auto">Routes会基于Payload Type进行类型和句柄的绑定，句柄内调用Services进行业务处理。</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="import { PAYLOAD_TYPES } from './constants'
import * as service from '../service'

export default {
  [PAYLOAD_TYPES.FETCH_FULL_DATA]: function (payload, callback) {
    callback(service.fetchFullData(payload))
  },
  [PAYLOAD_TYPES.FETCH_DROPDOWN_LIST]: function (payload, callback) {
    callback(service.fetchDropdownList(payload))
  },
  [PAYLOAD_TYPES.UPDATE_CELL]: function (payload, callback) {
    callback(service.updateCell(payload))
  }"><pre><span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-c1">PAYLOAD_TYPES</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">'./constants'</span>
<span class="pl-k">import</span> <span class="pl-c1">*</span> <span class="pl-k">as</span> <span class="pl-s1">service</span> <span class="pl-k">from</span> <span class="pl-s">'../service'</span>

<span class="pl-k">export</span> <span class="pl-k">default</span> <span class="pl-kos">{</span>
  <span class="pl-kos">[</span><span class="pl-c1">PAYLOAD_TYPES</span><span class="pl-kos">.</span><span class="pl-c1">FETCH_FULL_DATA</span><span class="pl-kos">]</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">payload</span><span class="pl-kos">,</span> <span class="pl-s1">callback</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-s1">callback</span><span class="pl-kos">(</span><span class="pl-s1">service</span><span class="pl-kos">.</span><span class="pl-en">fetchFullData</span><span class="pl-kos">(</span><span class="pl-s1">payload</span><span class="pl-kos">)</span><span class="pl-kos">)</span>
  <span class="pl-kos">}</span><span class="pl-kos">,</span>
  <span class="pl-kos">[</span><span class="pl-c1">PAYLOAD_TYPES</span><span class="pl-kos">.</span><span class="pl-c1">FETCH_DROPDOWN_LIST</span><span class="pl-kos">]</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">payload</span><span class="pl-kos">,</span> <span class="pl-s1">callback</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-s1">callback</span><span class="pl-kos">(</span><span class="pl-s1">service</span><span class="pl-kos">.</span><span class="pl-en">fetchDropdownList</span><span class="pl-kos">(</span><span class="pl-s1">payload</span><span class="pl-kos">)</span><span class="pl-kos">)</span>
  <span class="pl-kos">}</span><span class="pl-kos">,</span>
  <span class="pl-kos">[</span><span class="pl-c1">PAYLOAD_TYPES</span><span class="pl-kos">.</span><span class="pl-c1">UPDATE_CELL</span><span class="pl-kos">]</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">payload</span><span class="pl-kos">,</span> <span class="pl-s1">callback</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-s1">callback</span><span class="pl-kos">(</span><span class="pl-s1">service</span><span class="pl-kos">.</span><span class="pl-en">updateCell</span><span class="pl-kos">(</span><span class="pl-s1">payload</span><span class="pl-kos">)</span><span class="pl-kos">)</span>
  <span class="pl-kos">}</span></pre></div>
<p dir="auto">绑定路由至主进程</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="const establishConnection = () =&gt; {
  Object.keys(routes).forEach((routeName) =&gt; {
    ipcMain.on(routeName, (e, payload) =&gt; {
      routes[routeName](payload, (respond) =&gt; {
        e.sender.send(routeName, respond)
      })
    })
  })
}"><pre><span class="pl-k">const</span> <span class="pl-en">establishConnection</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
  <span class="pl-v">Object</span><span class="pl-kos">.</span><span class="pl-en">keys</span><span class="pl-kos">(</span><span class="pl-s1">routes</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">forEach</span><span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-s1">routeName</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-s1">ipcMain</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s1">routeName</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">e</span><span class="pl-kos">,</span> <span class="pl-s1">payload</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
      <span class="pl-s1">routes</span><span class="pl-kos">[</span><span class="pl-s1">routeName</span><span class="pl-kos">]</span><span class="pl-kos">(</span><span class="pl-s1">payload</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">respond</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
        <span class="pl-s1">e</span><span class="pl-kos">.</span><span class="pl-c1">sender</span><span class="pl-kos">.</span><span class="pl-en">send</span><span class="pl-kos">(</span><span class="pl-s1">routeName</span><span class="pl-kos">,</span> <span class="pl-s1">respond</span><span class="pl-kos">)</span>
      <span class="pl-kos">}</span><span class="pl-kos">)</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span>
  <span class="pl-kos">}</span><span class="pl-kos">)</span>
<span class="pl-kos">}</span></pre></div>
<p dir="auto">API声明</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="import { ipcRenderer } from 'electron'
import { PAYLOAD_TYPES } from '../channel/constants'
export default function fetchFullData(sheetName) {
  return new Promise((resolve, reject) =&gt; {
    // 定义请求参数
    const payload = {
      sheetName
    }

    // 发送请求
    ipcRenderer.send(PAYLOAD_TYPES.FETCH_FULL_DATA, payload)

    // 接受响应给callback
    ipcRenderer.once(PAYLOAD_TYPES.FETCH_FULL_DATA, (e, res) =&gt; {
      resolve(res)
    })
  })
}"><pre><span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">ipcRenderer</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">'electron'</span>
<span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-c1">PAYLOAD_TYPES</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">'../channel/constants'</span>
<span class="pl-k">export</span> <span class="pl-k">default</span> <span class="pl-k">function</span> <span class="pl-en">fetchFullData</span><span class="pl-kos">(</span><span class="pl-s1">sheetName</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
  <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-v">Promise</span><span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-s1">resolve</span><span class="pl-kos">,</span> <span class="pl-s1">reject</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-c">// 定义请求参数</span>
    <span class="pl-k">const</span> <span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
      sheetName
    <span class="pl-kos">}</span>

    <span class="pl-c">// 发送请求</span>
    <span class="pl-s1">ipcRenderer</span><span class="pl-kos">.</span><span class="pl-en">send</span><span class="pl-kos">(</span><span class="pl-c1">PAYLOAD_TYPES</span><span class="pl-kos">.</span><span class="pl-c1">FETCH_FULL_DATA</span><span class="pl-kos">,</span> <span class="pl-s1">payload</span><span class="pl-kos">)</span>

    <span class="pl-c">// 接受响应给callback</span>
    <span class="pl-s1">ipcRenderer</span><span class="pl-kos">.</span><span class="pl-en">once</span><span class="pl-kos">(</span><span class="pl-c1">PAYLOAD_TYPES</span><span class="pl-kos">.</span><span class="pl-c1">FETCH_FULL_DATA</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">e</span><span class="pl-kos">,</span> <span class="pl-s1">res</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
      <span class="pl-s1">resolve</span><span class="pl-kos">(</span><span class="pl-s1">res</span><span class="pl-kos">)</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span>
  <span class="pl-kos">}</span><span class="pl-kos">)</span>
<span class="pl-kos">}</span></pre></div>
<p dir="auto">�以上操作之后，API部分只要处理payload参数，发送到对应payload type的频道和绑定相应类型的响应句柄就可以了。</p>
<p dir="auto">这样API的入参很清晰，回参就是service的回参。一番映射之后，API和Services的逻辑就相当纯净了，无需考虑ipcMain和ipcRenderer等一系列Electron相关的通讯操作。</p>
<p dir="auto">新增API也只需要定义payload type，定义api，映射payload type和句柄，调用service就行了。</p>
<p dir="auto">这套设计的优点在于，基本API, Routes，Service的创建只需要copy过去就能行，改改payload和方法名称，设计一下入参即可。之后的开发就可以完全沉浸在Services这一层里。</p>
<p dir="auto">这套设计借鉴了Redux和Node.js里很多框架都采用的中心化路由映射的思想。</p>
<h2 dir="auto">数据存储</h2>
<p dir="auto">数据存储的话由于数据比较简单，目前我遇到的业务需求，基本一个mongodb就能够搞定。但是由于是electron，肯定不希望往使用方电脑装太多东西，其实mongodb也就是个json。那只需要找一个简单、成熟、语法友好的基于json的本地持久化工具即可。</p>
<p dir="auto">在这里使用<a href="https://github.com/typicode/lowdb">lowdb</a></p>
<h3 dir="auto">数据持久化</h3>
<p dir="auto">db文件放在user data里做持久化。<br>
获取user data的方法：<a href="https://electronjs.org/docs/api/app#appgetpathname" rel="nofollow">app.getPath()</a></p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="const filePath = path.join(app.getPath('userData'), '/data.json')"><pre><span class="pl-k">const</span> <span class="pl-s1">filePath</span> <span class="pl-c1">=</span> <span class="pl-s1">path</span><span class="pl-kos">.</span><span class="pl-en">join</span><span class="pl-kos">(</span><span class="pl-s1">app</span><span class="pl-kos">.</span><span class="pl-en">getPath</span><span class="pl-kos">(</span><span class="pl-s">'userData'</span><span class="pl-kos">)</span><span class="pl-kos">,</span> <span class="pl-s">'/data.json'</span><span class="pl-kos">)</span></pre></div>
<h3 dir="auto">lowdb</h3>
<p dir="auto">lowdb是基于lodash API的json持久化工具。前端做久了，Lodash肯定是知道的，语法也比较熟。在这放出一些简单的db操作</p>
<h4 dir="auto">初始化</h4>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="const low = require('lowdb')
const FileSync = require('lowdb/adapters/FileSync')

const filePath = path.join(app.getPath('userData'), '/data.json')
const adapter = new FileSync(filePath)
const db = low(adapter)"><pre><span class="pl-k">const</span> <span class="pl-s1">low</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'lowdb'</span><span class="pl-kos">)</span>
<span class="pl-k">const</span> <span class="pl-v">FileSync</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'lowdb/adapters/FileSync'</span><span class="pl-kos">)</span>

<span class="pl-k">const</span> <span class="pl-s1">filePath</span> <span class="pl-c1">=</span> <span class="pl-s1">path</span><span class="pl-kos">.</span><span class="pl-en">join</span><span class="pl-kos">(</span><span class="pl-s1">app</span><span class="pl-kos">.</span><span class="pl-en">getPath</span><span class="pl-kos">(</span><span class="pl-s">'userData'</span><span class="pl-kos">)</span><span class="pl-kos">,</span> <span class="pl-s">'/data.json'</span><span class="pl-kos">)</span>
<span class="pl-k">const</span> <span class="pl-s1">adapter</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-v">FileSync</span><span class="pl-kos">(</span><span class="pl-s1">filePath</span><span class="pl-kos">)</span>
<span class="pl-k">const</span> <span class="pl-s1">db</span> <span class="pl-c1">=</span> <span class="pl-s1">low</span><span class="pl-kos">(</span><span class="pl-s1">adapter</span><span class="pl-kos">)</span></pre></div>
<h4 dir="auto">db操作-增删改查</h4>
<p dir="auto">增</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="db.get('posts')
  .push({title: 'example'})
  .write()"><pre><span class="pl-s1">db</span><span class="pl-kos">.</span><span class="pl-en">get</span><span class="pl-kos">(</span><span class="pl-s">'posts'</span><span class="pl-kos">)</span>
  <span class="pl-kos">.</span><span class="pl-en">push</span><span class="pl-kos">(</span><span class="pl-kos">{</span><span class="pl-c1">title</span>: <span class="pl-s">'example'</span><span class="pl-kos">}</span><span class="pl-kos">)</span>
  <span class="pl-kos">.</span><span class="pl-en">write</span><span class="pl-kos">(</span><span class="pl-kos">)</span></pre></div>
<p dir="auto">删</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="db.get('posts')
  .remove({title: 'example'})
  .write()"><pre><span class="pl-s1">db</span><span class="pl-kos">.</span><span class="pl-en">get</span><span class="pl-kos">(</span><span class="pl-s">'posts'</span><span class="pl-kos">)</span>
  <span class="pl-kos">.</span><span class="pl-en">remove</span><span class="pl-kos">(</span><span class="pl-kos">{</span><span class="pl-c1">title</span>: <span class="pl-s">'example'</span><span class="pl-kos">}</span><span class="pl-kos">)</span>
  <span class="pl-kos">.</span><span class="pl-en">write</span><span class="pl-kos">(</span><span class="pl-kos">)</span></pre></div>
<p dir="auto">改</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="db.get('posts')
  .find({ title: 'example' })
  .assign({ title: 'hi!'})
  .write()"><pre><span class="pl-s1">db</span><span class="pl-kos">.</span><span class="pl-en">get</span><span class="pl-kos">(</span><span class="pl-s">'posts'</span><span class="pl-kos">)</span>
  <span class="pl-kos">.</span><span class="pl-en">find</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">title</span>: <span class="pl-s">'example'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span>
  <span class="pl-kos">.</span><span class="pl-en">assign</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">title</span>: <span class="pl-s">'hi!'</span><span class="pl-kos">}</span><span class="pl-kos">)</span>
  <span class="pl-kos">.</span><span class="pl-en">write</span><span class="pl-kos">(</span><span class="pl-kos">)</span></pre></div>
<p dir="auto">查</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="db.get('posts').value()"><pre><span class="pl-s1">db</span><span class="pl-kos">.</span><span class="pl-en">get</span><span class="pl-kos">(</span><span class="pl-s">'posts'</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">value</span><span class="pl-kos">(</span><span class="pl-kos">)</span></pre></div>
<h2 dir="auto">渲染进程</h2>
<p dir="auto">因为是基于Vue CLI搭的项目，那渲染进程这边肯定是选用Vue.js作为前端选型。到这里基本就跟普通web前端开发一样了。<br>
业务就调用API就行了。</p>
<h2 dir="auto">打包</h2>
<p dir="auto">electron-builder提供了很多的配置项。参考<a href="https://www.electron.build/configuration/configuration" rel="nofollow">https://www.electron.build/configuration/configuration</a></p>
<p dir="auto">配置文件也已经在上文中给出。</p>
<h2 dir="auto">总结</h2>
<p dir="auto">整个项目从构思到搭建，再到开发流程基本没采坑，主要还是因为文档比较给力。</p>
<p dir="auto">感觉唯一学到的东西就是终于有一套构建桌面端的解决方案了。。</p>
<p dir="auto">如果有后续更新会在此补充，感谢阅读。</p></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"html":"\u003ch1 dir=\"auto\"\u003e记一次Electron开发全过程\u003c/h1\u003e\n\u003cp dir=\"auto\"\u003e[[toc]]\u003c/p\u003e\n\u003ch2 dir=\"auto\"\u003e引子\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e有一个需要开发PC桌面端的需求。日常中使用的网易云音乐，Twitch client等都属于electron的产品。\u003cbr\u003e\nElectron对于前端开发来说上手非常简单，虽早有耳闻electron的强大，也看过一些文档和基本实现，但是没有完整的搭建、开发和维护过一个electron项目。借这个机会，熟悉一下electron技术栈，也写下本文，做一次技术积累。\u003c/p\u003e\n\u003ch2 dir=\"auto\"\u003eElectron\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003eElectron分为Main进程（主进程）和Renderer进程（渲染进程）\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e主进程为Node.js服务端环境，负责数据库处理，文件处理等\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e渲染进程为浏览器环境\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e主进程会将渲染进程的html，创建window，挂载html运行\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e主进程与渲染进程通过electron包提供的ipcMain和ipcRenderer进行进程通讯。其实就是一个EventEmitter，发布订阅模式。\u003c/p\u003e\n\u003ch2 dir=\"auto\"\u003e项目搭建\u003c/h2\u003e\n\u003ch3 dir=\"auto\"\u003e起步\u003c/h3\u003e\n\u003cp dir=\"auto\"\u003e项目开始基本跟着首页的\u003ca href=\"https://electronjs.org/docs/tutorial/development-environment#setting-up-windows\" rel=\"nofollow\"\u003e文档\u003c/a\u003e一步步走。\u003c/p\u003e\n\u003ch3 dir=\"auto\"\u003e脚手架\u003c/h3\u003e\n\u003cp dir=\"auto\"\u003e直到\u003ca href=\"https://electronjs.org/docs/tutorial/boilerplates-and-clis\" rel=\"nofollow\"\u003eBoilerplates and CLIs\u003c/a\u003e这一章。这一章开头也提到了说Electron只是提供了一种基于chromium渲染的桌面端包装而已。对于如何开发、构建、打包等是\"unopinionated\"。这一章中提到了很多的boilerplate和CLI的方案。\u003c/p\u003e\n\u003col dir=\"auto\"\u003e\n\u003cli\u003e\u003ccode class=\"notranslate\"\u003eelectron-forge\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode class=\"notranslate\"\u003eelectron-builder\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode class=\"notranslate\"\u003eelectron-react-boilerplate\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp dir=\"auto\"\u003e前两者是比较基本的脚手架。不限制renderer部分选型。\u003ccode class=\"notranslate\"\u003eelectron-react-boilerplate\u003c/code\u003e这个从名字看就基本限定死React了。由于时间紧迫，React的水平也确实有限。只能在前两者里挑选。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e对于前两个脚手架，我选的是star数较多的electron-builder，时间有限，仅能基于star数选型了。\u003c/p\u003e\n\u003ch3 dir=\"auto\"\u003eelectron-builder\u003c/h3\u003e\n\u003cp dir=\"auto\"\u003e使用\u003ccode class=\"notranslate\"\u003eyarn add electron-builder --dev\u003c/code\u003e安装。同时electron-builder本身也提供了一些\u003ca href=\"https://www.electron.build/#boilerplates\" rel=\"nofollow\"\u003e模板项目\u003c/a\u003e供快速开发参考。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e这里的我使用\u003ca href=\"https://nklayman.github.io/vue-cli-plugin-electron-builder/\" rel=\"nofollow\"\u003evue-cli-plugin-electron-builder\u003c/a\u003e进行项目搭建。这个是基于Vue CLI3的插件。关于Vue CLI3的安装和插件的安装在此不做赘述。\u003c/p\u003e\n\u003ch3 dir=\"auto\"\u003evue-cli-plugin-electron-builder插件配置\u003c/h3\u003e\n\u003cp dir=\"auto\"\u003e由于这个插件是Vue CLI的插件，那配置文件理所应当在vue.config.js内。\u003cbr\u003e\n贴上我目前的项目配置：\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"module.exports = {\n  pluginOptions: {\n    electronBuilder: {\n      builderOptions: {\n        \u0026quot;appId\u0026quot;: \u0026quot;com.example.app\u0026quot;,\n        \u0026quot;productName\u0026quot;: \u0026quot;test-app\u0026quot;,\n        directories: {\n          buildResources: './build',\n          output: \u0026quot;./dist\u0026quot;\n        },\n        \u0026quot;win\u0026quot;:{//win相关配置\n          \u0026quot;icon\u0026quot;:\u0026quot;./build/icon.png\u0026quot;,//图标，当前图标在根目录下，注意这里有两个坑\n          \u0026quot;target\u0026quot;: [\n            {\n              \u0026quot;target\u0026quot;: \u0026quot;nsis\u0026quot;,//利用nsis制作安装程序,\n              \u0026quot;arch\u0026quot;: [\n                \u0026quot;x64\u0026quot;,//64位\n                \u0026quot;ia32\u0026quot;//32位\n              ]\n            }\n          ],\n        },\n        \u0026quot;nsis\u0026quot;: {\n          \u0026quot;allowToChangeInstallationDirectory\u0026quot;: true,\n          oneClick: false,\n        }\n      }\n    }\n  }\n}\"\u003e\u003cpre\u003e\u003cspan class=\"pl-smi\"\u003emodule\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eexports\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003epluginOptions\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"pl-c1\"\u003eelectronBuilder\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003ebuilderOptions\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"pl-s\"\u003e\"appId\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"com.example.app\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"pl-s\"\u003e\"productName\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"test-app\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"pl-c1\"\u003edirectories\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"pl-c1\"\u003ebuildResources\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'./build'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"pl-c1\"\u003eoutput\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"./dist\"\u003c/span\u003e\n        \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"pl-s\"\u003e\"win\"\u003c/span\u003e:\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\u003cspan class=\"pl-c\"\u003e//win相关配置\u003c/span\u003e\n          \u003cspan class=\"pl-s\"\u003e\"icon\"\u003c/span\u003e:\u003cspan class=\"pl-s\"\u003e\"./build/icon.png\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\u003cspan class=\"pl-c\"\u003e//图标，当前图标在根目录下，注意这里有两个坑\u003c/span\u003e\n          \u003cspan class=\"pl-s\"\u003e\"target\"\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"pl-s\"\u003e\"target\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"nsis\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\u003cspan class=\"pl-c\"\u003e//利用nsis制作安装程序,\u003c/span\u003e\n              \u003cspan class=\"pl-s\"\u003e\"arch\"\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n                \u003cspan class=\"pl-s\"\u003e\"x64\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\u003cspan class=\"pl-c\"\u003e//64位\u003c/span\u003e\n                \u003cspan class=\"pl-s\"\u003e\"ia32\"\u003c/span\u003e\u003cspan class=\"pl-c\"\u003e//32位\u003c/span\u003e\n              \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"pl-s\"\u003e\"nsis\"\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"pl-s\"\u003e\"allowToChangeInstallationDirectory\"\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003etrue\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"pl-c1\"\u003eoneClick\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003efalse\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 dir=\"auto\"\u003e项目结构\u003c/h2\u003e\n\u003col dir=\"auto\"\u003e\n\u003cli\u003ebuild文件夹\u003cbr\u003e\n存放�打包需要的文件，例如icon等\u003c/li\u003e\n\u003cli\u003epublic文件夹\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e静态文件夹\u003c/li\u003e\n\u003cli\u003e包含渲染进程favcon.ico,index.html等静态文件\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003esrc文件夹\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e项目代码\u003c/li\u003e\n\u003cli\u003e-assets: 渲染进程静态文件夹\u003c/li\u003e\n\u003cli\u003e-biz: 主进程业务代码\u003c/li\u003e\n\u003cli\u003e-components: Vue.js组件\u003c/li\u003e\n\u003cli\u003e-plugins: Vue.js插件\u003c/li\u003e\n\u003cli\u003e-router: Vue-router\u003c/li\u003e\n\u003cli\u003e-store: Vuex\u003c/li\u003e\n\u003cli\u003e-views: Vue.js主视图\u003c/li\u003e\n\u003cli\u003ebackground.js: 主进程入口\u003c/li\u003e\n\u003cli\u003emain.js 渲染进程入口\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003evue.config.js\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003evue-cli3的配置文件\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 dir=\"auto\"\u003e主进程与渲染进程通讯\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e由于electron是一个unopinioned工具，他仅仅提供了进程通讯的方式，而对于如何组织通讯代码，如何封装API是没有一个最优解的。在这我会放出我对于进程通讯的二次封装。\u003c/p\u003e\n\u003ch3 dir=\"auto\"\u003e概念描述\u003c/h3\u003e\n\u003cp dir=\"auto\"\u003e首先定义几个概念\u003c/p\u003e\n\u003col dir=\"auto\"\u003e\n\u003cli\u003eAPI\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e应用程序接口。\u003c/li\u003e\n\u003cli\u003e这里的API是给调用方使用的，也就是渲染进程。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePayload Type\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e荷载类型。\u003c/li\u003e\n\u003cli\u003e定义业务类型（事件类型），其实也就是潜在的定义了业务入参和负责业务的具体描述。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eRoutes\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e路由。\u003c/li\u003e\n\u003cli\u003e分发绑定业务句柄和业务类型。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eServices\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e服务。\u003c/li\u003e\n\u003cli\u003e纯净的业务处理，会涉及业务数据处理，db操作等。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 dir=\"auto\"\u003e路由与业务绑定\u003c/h3\u003e\n\u003cp dir=\"auto\"\u003e先放出Payload Type的定义\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"const PAYLOAD_TYPES = Object.freeze({\n  FETCH_FULL_DATA: 'FETCH_FULL_DATA',\n  FETCH_DROPDOWN_LIST: 'FETCH_DROPDOWN_LIST',\n  UPDATE_CELL: 'UPDATE_CELL',\n  SORT_SHEET: 'SORT_SHEET',\n  VALIDATE_SHEET: 'VALIDATE_SHEET',\n  CALCULATE_SHEET: 'CALCULATE_SHEET',\n  FETCH_INITIAL_DATA: 'FETCH_INITIAL_DATA',\n  DELETE_ROW: 'DELETE_ROW'\n})\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003ePAYLOAD_TYPES\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eObject\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003efreeze\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eFETCH_FULL_DATA\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'FETCH_FULL_DATA'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eFETCH_DROPDOWN_LIST\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'FETCH_DROPDOWN_LIST'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eUPDATE_CELL\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'UPDATE_CELL'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eSORT_SHEET\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'SORT_SHEET'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eVALIDATE_SHEET\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'VALIDATE_SHEET'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eCALCULATE_SHEET\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'CALCULATE_SHEET'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eFETCH_INITIAL_DATA\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'FETCH_INITIAL_DATA'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eDELETE_ROW\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'DELETE_ROW'\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003eRoutes会基于Payload Type进行类型和句柄的绑定，句柄内调用Services进行业务处理。\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"import { PAYLOAD_TYPES } from './constants'\nimport * as service from '../service'\n\nexport default {\n  [PAYLOAD_TYPES.FETCH_FULL_DATA]: function (payload, callback) {\n    callback(service.fetchFullData(payload))\n  },\n  [PAYLOAD_TYPES.FETCH_DROPDOWN_LIST]: function (payload, callback) {\n    callback(service.fetchDropdownList(payload))\n  },\n  [PAYLOAD_TYPES.UPDATE_CELL]: function (payload, callback) {\n    callback(service.updateCell(payload))\n  }\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003ePAYLOAD_TYPES\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e'./constants'\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e*\u003c/span\u003e \u003cspan class=\"pl-k\"\u003eas\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eservice\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e'../service'\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003eexport\u003c/span\u003e \u003cspan class=\"pl-k\"\u003edefault\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003ePAYLOAD_TYPES\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eFETCH_FULL_DATA\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e: \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003ecallback\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"pl-s1\"\u003ecallback\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eservice\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003efetchFullData\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003ePAYLOAD_TYPES\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eFETCH_DROPDOWN_LIST\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e: \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003ecallback\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"pl-s1\"\u003ecallback\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eservice\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003efetchDropdownList\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003ePAYLOAD_TYPES\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eUPDATE_CELL\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e: \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003ecallback\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"pl-s1\"\u003ecallback\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eservice\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eupdateCell\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e绑定路由至主进程\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"const establishConnection = () =\u0026gt; {\n  Object.keys(routes).forEach((routeName) =\u0026gt; {\n    ipcMain.on(routeName, (e, payload) =\u0026gt; {\n      routes[routeName](payload, (respond) =\u0026gt; {\n        e.sender.send(routeName, respond)\n      })\n    })\n  })\n}\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-en\"\u003eestablishConnection\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-v\"\u003eObject\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003ekeys\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eroutes\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eforEach\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003erouteName\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"pl-s1\"\u003eipcMain\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eon\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003erouteName\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003ee\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"pl-s1\"\u003eroutes\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003erouteName\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003erespond\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"pl-s1\"\u003ee\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003esender\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003esend\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003erouteName\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003erespond\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003eAPI声明\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"import { ipcRenderer } from 'electron'\nimport { PAYLOAD_TYPES } from '../channel/constants'\nexport default function fetchFullData(sheetName) {\n  return new Promise((resolve, reject) =\u0026gt; {\n    // 定义请求参数\n    const payload = {\n      sheetName\n    }\n\n    // 发送请求\n    ipcRenderer.send(PAYLOAD_TYPES.FETCH_FULL_DATA, payload)\n\n    // 接受响应给callback\n    ipcRenderer.once(PAYLOAD_TYPES.FETCH_FULL_DATA, (e, res) =\u0026gt; {\n      resolve(res)\n    })\n  })\n}\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eipcRenderer\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e'electron'\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003ePAYLOAD_TYPES\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e'../channel/constants'\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eexport\u003c/span\u003e \u003cspan class=\"pl-k\"\u003edefault\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e \u003cspan class=\"pl-en\"\u003efetchFullData\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003esheetName\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"pl-k\"\u003enew\u003c/span\u003e \u003cspan class=\"pl-v\"\u003ePromise\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eresolve\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003ereject\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"pl-c\"\u003e// 定义请求参数\u003c/span\u003e\n    \u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n      sheetName\n    \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"pl-c\"\u003e// 发送请求\u003c/span\u003e\n    \u003cspan class=\"pl-s1\"\u003eipcRenderer\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003esend\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003ePAYLOAD_TYPES\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eFETCH_FULL_DATA\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003epayload\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"pl-c\"\u003e// 接受响应给callback\u003c/span\u003e\n    \u003cspan class=\"pl-s1\"\u003eipcRenderer\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eonce\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003ePAYLOAD_TYPES\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003eFETCH_FULL_DATA\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003ee\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eres\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"pl-s1\"\u003eresolve\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eres\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e�以上操作之后，API部分只要处理payload参数，发送到对应payload type的频道和绑定相应类型的响应句柄就可以了。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e这样API的入参很清晰，回参就是service的回参。一番映射之后，API和Services的逻辑就相当纯净了，无需考虑ipcMain和ipcRenderer等一系列Electron相关的通讯操作。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e新增API也只需要定义payload type，定义api，映射payload type和句柄，调用service就行了。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e这套设计的优点在于，基本API, Routes，Service的创建只需要copy过去就能行，改改payload和方法名称，设计一下入参即可。之后的开发就可以完全沉浸在Services这一层里。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e这套设计借鉴了Redux和Node.js里很多框架都采用的中心化路由映射的思想。\u003c/p\u003e\n\u003ch2 dir=\"auto\"\u003e数据存储\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e数据存储的话由于数据比较简单，目前我遇到的业务需求，基本一个mongodb就能够搞定。但是由于是electron，肯定不希望往使用方电脑装太多东西，其实mongodb也就是个json。那只需要找一个简单、成熟、语法友好的基于json的本地持久化工具即可。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e在这里使用\u003ca href=\"https://github.com/typicode/lowdb\"\u003elowdb\u003c/a\u003e\u003c/p\u003e\n\u003ch3 dir=\"auto\"\u003e数据持久化\u003c/h3\u003e\n\u003cp dir=\"auto\"\u003edb文件放在user data里做持久化。\u003cbr\u003e\n获取user data的方法：\u003ca href=\"https://electronjs.org/docs/api/app#appgetpathname\" rel=\"nofollow\"\u003eapp.getPath()\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"const filePath = path.join(app.getPath('userData'), '/data.json')\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003efilePath\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003epath\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003ejoin\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eapp\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003egetPath\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e'userData'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e'/data.json'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 dir=\"auto\"\u003elowdb\u003c/h3\u003e\n\u003cp dir=\"auto\"\u003elowdb是基于lodash API的json持久化工具。前端做久了，Lodash肯定是知道的，语法也比较熟。在这放出一些简单的db操作\u003c/p\u003e\n\u003ch4 dir=\"auto\"\u003e初始化\u003c/h4\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"const low = require('lowdb')\nconst FileSync = require('lowdb/adapters/FileSync')\n\nconst filePath = path.join(app.getPath('userData'), '/data.json')\nconst adapter = new FileSync(filePath)\nconst db = low(adapter)\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003elow\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-en\"\u003erequire\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e'lowdb'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eFileSync\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-en\"\u003erequire\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e'lowdb/adapters/FileSync'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003efilePath\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003epath\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003ejoin\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eapp\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003egetPath\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e'userData'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e'/data.json'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eadapter\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-k\"\u003enew\u003c/span\u003e \u003cspan class=\"pl-v\"\u003eFileSync\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003efilePath\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003edb\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003elow\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s1\"\u003eadapter\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 dir=\"auto\"\u003edb操作-增删改查\u003c/h4\u003e\n\u003cp dir=\"auto\"\u003e增\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"db.get('posts')\n  .push({title: 'example'})\n  .write()\"\u003e\u003cpre\u003e\u003cspan class=\"pl-s1\"\u003edb\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eget\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e'posts'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003epush\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003etitle\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'example'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e删\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"db.get('posts')\n  .remove({title: 'example'})\n  .write()\"\u003e\u003cpre\u003e\u003cspan class=\"pl-s1\"\u003edb\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eget\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e'posts'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eremove\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003etitle\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'example'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e改\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"db.get('posts')\n  .find({ title: 'example' })\n  .assign({ title: 'hi!'})\n  .write()\"\u003e\u003cpre\u003e\u003cspan class=\"pl-s1\"\u003edb\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eget\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e'posts'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003efind\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003etitle\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'example'\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eassign\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003etitle\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e'hi!'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e查\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"db.get('posts').value()\"\u003e\u003cpre\u003e\u003cspan class=\"pl-s1\"\u003edb\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003eget\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-s\"\u003e'posts'\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-en\"\u003evalue\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 dir=\"auto\"\u003e渲染进程\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e因为是基于Vue CLI搭的项目，那渲染进程这边肯定是选用Vue.js作为前端选型。到这里基本就跟普通web前端开发一样了。\u003cbr\u003e\n业务就调用API就行了。\u003c/p\u003e\n\u003ch2 dir=\"auto\"\u003e打包\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003eelectron-builder提供了很多的配置项。参考\u003ca href=\"https://www.electron.build/configuration/configuration\" rel=\"nofollow\"\u003ehttps://www.electron.build/configuration/configuration\u003c/a\u003e\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e配置文件也已经在上文中给出。\u003c/p\u003e\n\u003ch2 dir=\"auto\"\u003e总结\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e整个项目从构思到搭建，再到开发流程基本没采坑，主要还是因为文档比较给力。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e感觉唯一学到的东西就是终于有一套构建桌面端的解决方案了。。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003e如果有后续更新会在此补充，感谢阅读。\u003c/p\u003e"},"__N_SSG":true},"page":"/post/[id]","query":{"id":"3"},"buildId":"rBbusu2MNuhg6PTCw5Tx9","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>