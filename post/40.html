<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Minimal Life</title><meta name="description" content="Minimal Life Blog"/><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/blog/_next/static/css/ae2bf281c5f69f12.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/ae2bf281c5f69f12.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/dc36ea6314551c03.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/dc36ea6314551c03.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/blog/_next/static/chunks/webpack-4d5208940e01a3dc.js" defer=""></script><script src="/blog/_next/static/chunks/framework-00b57966872fc495.js" defer=""></script><script src="/blog/_next/static/chunks/main-04fa69cd18d105e9.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-f55443f2448c8e66.js" defer=""></script><script src="/blog/_next/static/chunks/247-b84c2316c963d09c.js" defer=""></script><script src="/blog/_next/static/chunks/pages/post/%5Bid%5D-6212bec497a425a5.js" defer=""></script><script src="/blog/_next/static/YOVZ7-Oaws0N8Ni2F4oyN/_buildManifest.js" defer=""></script><script src="/blog/_next/static/YOVZ7-Oaws0N8Ni2F4oyN/_ssgManifest.js" defer=""></script><script src="/blog/_next/static/YOVZ7-Oaws0N8Ni2F4oyN/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_container__KdNo5"><header class="Layout_header__TY1Ur"><div class="Avatar_avatar__Wqsgs"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="Avatar_img__fPm7S" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://avatars.githubusercontent.com/u/17166940?v=4 1x, https://avatars.githubusercontent.com/u/17166940?v=4 2x" src="https://avatars.githubusercontent.com/u/17166940?v=4" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="Avatar_img__fPm7S" loading="lazy"/></noscript></span><div class="Avatar_username__94Fmm">phshy0607</div></div><div class="Navbar_navbar__dE_dF"><nav class="Navbar_nav__lgcdH"><a href="/blog">Home</a></nav><nav class="Navbar_nav__lgcdH"><a href="/blog/posts">Posts</a></nav></div></header><main class="Layout_main__CO5d2"><div class="markdown-body scroller"><h1 dir="auto">rollup打包 _export is not defined问题解决方案</h1>
<h2 dir="auto">Rollup 配置</h2>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="import { babel } from &quot;@rollup/plugin-babel&quot;;
import commonjs from &quot;@rollup/plugin-commonjs&quot;;
import resolve from &quot;@rollup/plugin-node-resolve&quot;;
import url from &quot;@rollup/plugin-url&quot;;
import external from &quot;rollup-plugin-peer-deps-external&quot;;
import postcss from &quot;rollup-plugin-postcss&quot;;
import typescript from &quot;rollup-plugin-typescript&quot;;
import pkg from &quot;./package.json&quot;;

const config = {
  input: &quot;src/index.ts&quot;,
  output: [
    {
      file: pkg.main,
      format: &quot;cjs&quot;,
      exports: &quot;named&quot;,
    },
    {
      file: pkg.module,
      format: &quot;es&quot;,
      exports: &quot;named&quot;,
    },
  ],
  plugins: [
    resolve(),
    commonjs(),
    postcss({
      plugins: [],
      minimize: true,
    }),
    external({
      includeDependencies: false,
    }),
    babel({
      babelHelpers: &quot;bundled&quot;,
      presets: [
        [
          &quot;@babel/preset-env&quot;,
          {
            useBuiltIns: &quot;usage&quot;,
            corejs: 3,
          },
        ],
      ],
    }),
    url(),
    typescript({ tsconfig: &quot;./tsconfig.json&quot; }),
  ],
};

export default config;"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-kos">{</span> <span class="pl-s1">babel</span> <span class="pl-kos">}</span> <span class="pl-k">from</span> <span class="pl-s">"@rollup/plugin-babel"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">commonjs</span> <span class="pl-k">from</span> <span class="pl-s">"@rollup/plugin-commonjs"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">resolve</span> <span class="pl-k">from</span> <span class="pl-s">"@rollup/plugin-node-resolve"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">url</span> <span class="pl-k">from</span> <span class="pl-s">"@rollup/plugin-url"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">external</span> <span class="pl-k">from</span> <span class="pl-s">"rollup-plugin-peer-deps-external"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">postcss</span> <span class="pl-k">from</span> <span class="pl-s">"rollup-plugin-postcss"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">typescript</span> <span class="pl-k">from</span> <span class="pl-s">"rollup-plugin-typescript"</span><span class="pl-kos">;</span>
<span class="pl-k">import</span> <span class="pl-s1">pkg</span> <span class="pl-k">from</span> <span class="pl-s">"./package.json"</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">config</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
  <span class="pl-c1">input</span>: <span class="pl-s">"src/index.ts"</span><span class="pl-kos">,</span>
  <span class="pl-c1">output</span>: <span class="pl-kos">[</span>
    <span class="pl-kos">{</span>
      <span class="pl-c1">file</span>: <span class="pl-s1">pkg</span><span class="pl-kos">.</span><span class="pl-c1">main</span><span class="pl-kos">,</span>
      <span class="pl-c1">format</span>: <span class="pl-s">"cjs"</span><span class="pl-kos">,</span>
      <span class="pl-c1">exports</span>: <span class="pl-s">"named"</span><span class="pl-kos">,</span>
    <span class="pl-kos">}</span><span class="pl-kos">,</span>
    <span class="pl-kos">{</span>
      <span class="pl-c1">file</span>: <span class="pl-s1">pkg</span><span class="pl-kos">.</span><span class="pl-c1">module</span><span class="pl-kos">,</span>
      <span class="pl-c1">format</span>: <span class="pl-s">"es"</span><span class="pl-kos">,</span>
      <span class="pl-c1">exports</span>: <span class="pl-s">"named"</span><span class="pl-kos">,</span>
    <span class="pl-kos">}</span><span class="pl-kos">,</span>
  <span class="pl-kos">]</span><span class="pl-kos">,</span>
  <span class="pl-c1">plugins</span>: <span class="pl-kos">[</span>
    <span class="pl-en">resolve</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-en">commonjs</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-en">postcss</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
      <span class="pl-c1">plugins</span>: <span class="pl-kos">[</span><span class="pl-kos">]</span><span class="pl-kos">,</span>
      <span class="pl-c1">minimize</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-en">external</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
      <span class="pl-c1">includeDependencies</span>: <span class="pl-c1">false</span><span class="pl-kos">,</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-en">babel</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
      <span class="pl-c1">babelHelpers</span>: <span class="pl-s">"bundled"</span><span class="pl-kos">,</span>
      <span class="pl-c1">presets</span>: <span class="pl-kos">[</span>
        <span class="pl-kos">[</span>
          <span class="pl-s">"@babel/preset-env"</span><span class="pl-kos">,</span>
          <span class="pl-kos">{</span>
            <span class="pl-c1">useBuiltIns</span>: <span class="pl-s">"usage"</span><span class="pl-kos">,</span>
            <span class="pl-c1">corejs</span>: <span class="pl-c1">3</span><span class="pl-kos">,</span>
          <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-kos">]</span><span class="pl-kos">,</span>
      <span class="pl-kos">]</span><span class="pl-kos">,</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-en">url</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-en">typescript</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">tsconfig</span>: <span class="pl-s">"./tsconfig.json"</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
  <span class="pl-kos">]</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-k">export</span> <span class="pl-k">default</span> <span class="pl-s1">config</span><span class="pl-kos">;</span></pre></div>
<h2 dir="auto">问题</h2>
<p dir="auto">报出 <code class="notranslate">$$1w is not defined</code>，实际查证是$$1w指向了<code class="notranslate">_export</code>这个方法。而<code class="notranslate">_export</code>的定义在最下方。</p>
<h2 dir="auto">原因</h2>
<p dir="auto">根据以下Issue</p>
<ol dir="auto">
<li><a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="642758941" data-permission-text="Title is private" data-url="https://github.com/rollup/plugins/issues/466" data-hovercard-type="issue" data-hovercard-url="/rollup/plugins/issues/466/hovercard" href="https://github.com/rollup/plugins/issues/466">rollup/plugins#466</a></li>
<li><a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="712450081" data-permission-text="Title is private" data-url="https://github.com/rollup/rollup/issues/3802" data-hovercard-type="issue" data-hovercard-url="/rollup/rollup/issues/3802/hovercard" href="https://github.com/rollup/rollup/issues/3802">rollup/rollup#3802</a></li>
</ol>
<p dir="auto">原因是当打包dependencies时，core-js本身会被babel再解析一遍，造成循环引用。</p>
<p dir="auto">Quote:</p>
<blockquote>
<p dir="auto">You need to exclude core-js from babel or @babel/preset-env with useBuiltins: 'usage' will create a circular reference trying to process core-js itself:</p>
</blockquote>
<h2 dir="auto">解决方案</h2>
<ol dir="auto">
<li>external插件配置<code class="notranslate">includeDependencies: true</code>, 产物不打包core-js</li>
<li>babel插件exclude core-js</li>
</ol>
<h2 dir="auto">结果</h2>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="external({
  includeDependencies: false,
}),
babel({
  babelHelpers: &quot;bundled&quot;,
  exclude: [/core-js/],
  presets: [
    [
      &quot;@babel/preset-env&quot;,
      {
        useBuiltIns: &quot;usage&quot;,
        corejs: 3,
      },
    ],
  ],
})"><pre class="notranslate"><span class="pl-en">external</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
  <span class="pl-c1">includeDependencies</span>: <span class="pl-c1">false</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
<span class="pl-en">babel</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
  <span class="pl-c1">babelHelpers</span>: <span class="pl-s">"bundled"</span><span class="pl-kos">,</span>
  <span class="pl-c1">exclude</span>: <span class="pl-kos">[</span><span class="pl-pds"><span class="pl-c1">/</span>core-js<span class="pl-c1">/</span></span><span class="pl-kos">]</span><span class="pl-kos">,</span>
  <span class="pl-c1">presets</span>: <span class="pl-kos">[</span>
    <span class="pl-kos">[</span>
      <span class="pl-s">"@babel/preset-env"</span><span class="pl-kos">,</span>
      <span class="pl-kos">{</span>
        <span class="pl-c1">useBuiltIns</span>: <span class="pl-s">"usage"</span><span class="pl-kos">,</span>
        <span class="pl-c1">corejs</span>: <span class="pl-c1">3</span><span class="pl-kos">,</span>
      <span class="pl-kos">}</span><span class="pl-kos">,</span>
    <span class="pl-kos">]</span><span class="pl-kos">,</span>
  <span class="pl-kos">]</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span></pre></div>
<p dir="auto">或者</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="external({
  includeDependencies: true,
}),
babel({
  babelHelpers: &quot;bundled&quot;,
  presets: [
    [
      &quot;@babel/preset-env&quot;,
      {
        useBuiltIns: &quot;usage&quot;,
        corejs: 3,
      },
    ],
  ],
})"><pre class="notranslate"><span class="pl-en">external</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
  <span class="pl-c1">includeDependencies</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
<span class="pl-en">babel</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
  <span class="pl-c1">babelHelpers</span>: <span class="pl-s">"bundled"</span><span class="pl-kos">,</span>
  <span class="pl-c1">presets</span>: <span class="pl-kos">[</span>
    <span class="pl-kos">[</span>
      <span class="pl-s">"@babel/preset-env"</span><span class="pl-kos">,</span>
      <span class="pl-kos">{</span>
        <span class="pl-c1">useBuiltIns</span>: <span class="pl-s">"usage"</span><span class="pl-kos">,</span>
        <span class="pl-c1">corejs</span>: <span class="pl-c1">3</span><span class="pl-kos">,</span>
      <span class="pl-kos">}</span><span class="pl-kos">,</span>
    <span class="pl-kos">]</span><span class="pl-kos">,</span>
  <span class="pl-kos">]</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span></pre></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"html":"\u003ch1 dir=\"auto\"\u003erollup打包 _export is not defined问题解决方案\u003c/h1\u003e\n\u003ch2 dir=\"auto\"\u003eRollup 配置\u003c/h2\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"import { babel } from \u0026quot;@rollup/plugin-babel\u0026quot;;\nimport commonjs from \u0026quot;@rollup/plugin-commonjs\u0026quot;;\nimport resolve from \u0026quot;@rollup/plugin-node-resolve\u0026quot;;\nimport url from \u0026quot;@rollup/plugin-url\u0026quot;;\nimport external from \u0026quot;rollup-plugin-peer-deps-external\u0026quot;;\nimport postcss from \u0026quot;rollup-plugin-postcss\u0026quot;;\nimport typescript from \u0026quot;rollup-plugin-typescript\u0026quot;;\nimport pkg from \u0026quot;./package.json\u0026quot;;\n\nconst config = {\n  input: \u0026quot;src/index.ts\u0026quot;,\n  output: [\n    {\n      file: pkg.main,\n      format: \u0026quot;cjs\u0026quot;,\n      exports: \u0026quot;named\u0026quot;,\n    },\n    {\n      file: pkg.module,\n      format: \u0026quot;es\u0026quot;,\n      exports: \u0026quot;named\u0026quot;,\n    },\n  ],\n  plugins: [\n    resolve(),\n    commonjs(),\n    postcss({\n      plugins: [],\n      minimize: true,\n    }),\n    external({\n      includeDependencies: false,\n    }),\n    babel({\n      babelHelpers: \u0026quot;bundled\u0026quot;,\n      presets: [\n        [\n          \u0026quot;@babel/preset-env\u0026quot;,\n          {\n            useBuiltIns: \u0026quot;usage\u0026quot;,\n            corejs: 3,\n          },\n        ],\n      ],\n    }),\n    url(),\n    typescript({ tsconfig: \u0026quot;./tsconfig.json\u0026quot; }),\n  ],\n};\n\nexport default config;\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003ebabel\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"@rollup/plugin-babel\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003ecommonjs\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"@rollup/plugin-commonjs\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eresolve\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"@rollup/plugin-node-resolve\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eurl\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"@rollup/plugin-url\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003eexternal\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"rollup-plugin-peer-deps-external\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003epostcss\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"rollup-plugin-postcss\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003etypescript\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"rollup-plugin-typescript\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003epkg\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\"./package.json\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003econst\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003econfig\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003einput\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"src/index.ts\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eoutput\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003efile\u003c/span\u003e: \u003cspan class=\"pl-s1\"\u003epkg\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003emain\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003eformat\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"cjs\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003eexports\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"named\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003efile\u003c/span\u003e: \u003cspan class=\"pl-s1\"\u003epkg\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e.\u003c/span\u003e\u003cspan class=\"pl-c1\"\u003emodule\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003eformat\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"es\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003eexports\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"named\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eplugins\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"pl-en\"\u003eresolve\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-en\"\u003ecommonjs\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-en\"\u003epostcss\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003eplugins\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003eminimize\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003etrue\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-en\"\u003eexternal\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003eincludeDependencies\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003efalse\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-en\"\u003ebabel\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003ebabelHelpers\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"bundled\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-c1\"\u003epresets\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n          \u003cspan class=\"pl-s\"\u003e\"@babel/preset-env\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"pl-c1\"\u003euseBuiltIns\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"usage\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"pl-c1\"\u003ecorejs\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003e3\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-en\"\u003eurl\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-en\"\u003etypescript\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003etsconfig\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"./tsconfig.json\"\u003c/span\u003e \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"pl-k\"\u003eexport\u003c/span\u003e \u003cspan class=\"pl-k\"\u003edefault\u003c/span\u003e \u003cspan class=\"pl-s1\"\u003econfig\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e;\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 dir=\"auto\"\u003e问题\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e报出 \u003ccode class=\"notranslate\"\u003e$$1w is not defined\u003c/code\u003e，实际查证是$$1w指向了\u003ccode class=\"notranslate\"\u003e_export\u003c/code\u003e这个方法。而\u003ccode class=\"notranslate\"\u003e_export\u003c/code\u003e的定义在最下方。\u003c/p\u003e\n\u003ch2 dir=\"auto\"\u003e原因\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e根据以下Issue\u003c/p\u003e\n\u003col dir=\"auto\"\u003e\n\u003cli\u003e\u003ca class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"642758941\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rollup/plugins/issues/466\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rollup/plugins/issues/466/hovercard\" href=\"https://github.com/rollup/plugins/issues/466\"\u003erollup/plugins#466\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"712450081\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rollup/rollup/issues/3802\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rollup/rollup/issues/3802/hovercard\" href=\"https://github.com/rollup/rollup/issues/3802\"\u003erollup/rollup#3802\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp dir=\"auto\"\u003e原因是当打包dependencies时，core-js本身会被babel再解析一遍，造成循环引用。\u003c/p\u003e\n\u003cp dir=\"auto\"\u003eQuote:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp dir=\"auto\"\u003eYou need to exclude core-js from babel or @babel/preset-env with useBuiltins: 'usage' will create a circular reference trying to process core-js itself:\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 dir=\"auto\"\u003e解决方案\u003c/h2\u003e\n\u003col dir=\"auto\"\u003e\n\u003cli\u003eexternal插件配置\u003ccode class=\"notranslate\"\u003eincludeDependencies: true\u003c/code\u003e, 产物不打包core-js\u003c/li\u003e\n\u003cli\u003ebabel插件exclude core-js\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 dir=\"auto\"\u003e结果\u003c/h2\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"external({\n  includeDependencies: false,\n}),\nbabel({\n  babelHelpers: \u0026quot;bundled\u0026quot;,\n  exclude: [/core-js/],\n  presets: [\n    [\n      \u0026quot;@babel/preset-env\u0026quot;,\n      {\n        useBuiltIns: \u0026quot;usage\u0026quot;,\n        corejs: 3,\n      },\n    ],\n  ],\n})\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-en\"\u003eexternal\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eincludeDependencies\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003efalse\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n\u003cspan class=\"pl-en\"\u003ebabel\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003ebabelHelpers\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"bundled\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eexclude\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\u003cspan class=\"pl-pds\"\u003e\u003cspan class=\"pl-c1\"\u003e/\u003c/span\u003ecore-js\u003cspan class=\"pl-c1\"\u003e/\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003epresets\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"pl-s\"\u003e\"@babel/preset-env\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"pl-c1\"\u003euseBuiltIns\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"usage\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"pl-c1\"\u003ecorejs\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003e3\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp dir=\"auto\"\u003e或者\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"external({\n  includeDependencies: true,\n}),\nbabel({\n  babelHelpers: \u0026quot;bundled\u0026quot;,\n  presets: [\n    [\n      \u0026quot;@babel/preset-env\u0026quot;,\n      {\n        useBuiltIns: \u0026quot;usage\u0026quot;,\n        corejs: 3,\n      },\n    ],\n  ],\n})\"\u003e\u003cpre class=\"notranslate\"\u003e\u003cspan class=\"pl-en\"\u003eexternal\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003eincludeDependencies\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003etrue\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n\u003cspan class=\"pl-en\"\u003ebabel\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e(\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003ebabelHelpers\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"bundled\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-c1\"\u003epresets\u003c/span\u003e: \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"pl-s\"\u003e\"@babel/preset-env\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-kos\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"pl-c1\"\u003euseBuiltIns\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\"usage\"\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"pl-c1\"\u003ecorejs\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003e3\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"pl-kos\"\u003e]\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e,\u003c/span\u003e\n\u003cspan class=\"pl-kos\"\u003e}\u003c/span\u003e\u003cspan class=\"pl-kos\"\u003e)\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e"},"__N_SSG":true},"page":"/post/[id]","query":{"id":"40"},"buildId":"YOVZ7-Oaws0N8Ni2F4oyN","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>