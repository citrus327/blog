<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Minimal Life</title><meta name="description" content="Minimal Life Blog"/><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/blog/_next/static/css/6db3845f9f3a867b.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/6db3845f9f3a867b.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/452f28fbf231f2d9.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/452f28fbf231f2d9.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/blog/_next/static/chunks/webpack-4d5208940e01a3dc.js" defer=""></script><script src="/blog/_next/static/chunks/framework-00b57966872fc495.js" defer=""></script><script src="/blog/_next/static/chunks/main-04fa69cd18d105e9.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-f55443f2448c8e66.js" defer=""></script><script src="/blog/_next/static/chunks/247-b84c2316c963d09c.js" defer=""></script><script src="/blog/_next/static/chunks/pages/post/%5Bid%5D-5f7ac47925745e56.js" defer=""></script><script src="/blog/_next/static/m0Bx2PmEL6WGIOdVS1quI/_buildManifest.js" defer=""></script><script src="/blog/_next/static/m0Bx2PmEL6WGIOdVS1quI/_ssgManifest.js" defer=""></script><script src="/blog/_next/static/m0Bx2PmEL6WGIOdVS1quI/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_container__KdNo5"><header class="Layout_header__TY1Ur"><div class="Avatar_avatar__Wqsgs"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="Avatar_img__fPm7S" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://avatars.githubusercontent.com/u/17166940?v=4 1x, https://avatars.githubusercontent.com/u/17166940?v=4 2x" src="https://avatars.githubusercontent.com/u/17166940?v=4" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="Avatar_img__fPm7S" loading="lazy"/></noscript></span><div class="Avatar_username__94Fmm">phshy0607</div></div><div class="Navbar_navbar__dE_dF"><nav class="Navbar_nav__lgcdH"><a href="/blog">Home</a></nav><nav class="Navbar_nav__lgcdH"><a href="/blog/posts">Posts</a></nav></div></header><main class="Layout_main__CO5d2"><div class="markdown-body"><h1 dir="auto">使用 Github Action 自动发布 npm 包</h1>
<h2 dir="auto">简介</h2>
<p dir="auto">下午抽空调研了一下如何使用 github action 来自动发布 npm 包。写下本文记录。</p>
<h2 dir="auto">步骤</h2>
<ul dir="auto">
<li>准备 npm token</li>
<li>设置 github secret</li>
<li>设置 github actions</li>
</ul>
<h2 dir="auto">准备 npm token</h2>
<ul dir="auto">
<li>访问<a href="https://www.npmjs.com/" rel="nofollow">https://www.npmjs.com/</a> 并登录。</li>
<li>进入个人设置 - access tokens。</li>
<li>选择<code class="notranslate">Generate New Token</code>，输入密码确认。</li>
<li>给该 token 起个名字(名字不影响，为了方便记忆可以使用<code class="notranslate">npm_publish</code>这种)。并设置 token 类型为<code class="notranslate">Automation</code></li>
<li>记下该 token。</li>
</ul>
<h2 dir="auto">设置 github secret</h2>
<ul dir="auto">
<li>进入 github 仓库。</li>
<li>点击仓库的<code class="notranslate">Settings - Actions</code>，点击右上角的<code class="notranslate">New Repository Secret</code></li>
<li>输入 Token 名称，例如<code class="notranslate">NPM_PUBLISH_TOKEN</code>, 并填入之前在 npmjs.com 上创建的 npm token</li>
</ul>
<h2 dir="auto">设置 github actions</h2>
<ul dir="auto">
<li>在仓库内新建<code class="notranslate">.github/workflows/publish.yml</code>文件</li>
<li>文件内容如下:</li>
</ul>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="name: Publish to NPM
on:
  # release时触发。
  release:
    types: [created]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 16
      # 因为我的仓库使用的是pnpm，所以需要安装pnpm, 若使用的是npm则可以忽略。
      - name: Install Pnpm
        uses: pnpm/action-setup@v2.2.2
        with:
          version: 6.0.2
      # 安装依赖，脚本(run部分)可以自己写
      - name: Install dependencies
        run: pnpm install
      # 可以使用prepublishOnly来做build, 这样build可以在ci环节中剔除。见下文Tips
      - name: Build
        run: pnpm run build
      # 使用JS-DevTools/npm-publish@v1来进行npm发布。
      - name: Publish package on NPM 📦
        uses: JS-DevTools/npm-publish@v1
        with:
          # token里的secrets.NPM_PUBLISH_TOKEN就是在仓库内设定的token名。
          token: ${{ secrets.NPM_PUBLISH_TOKEN }}"><pre><span class="pl-ent">name</span>: <span class="pl-s">Publish to NPM</span>
<span class="pl-ent">on</span>:
  <span class="pl-c"><span class="pl-c">#</span> release时触发。</span>
  <span class="pl-ent">release</span>:
    <span class="pl-ent">types</span>: <span class="pl-s">[created]</span>
<span class="pl-ent">jobs</span>:
  <span class="pl-ent">build</span>:
    <span class="pl-ent">runs-on</span>: <span class="pl-s">ubuntu-latest</span>
    <span class="pl-ent">steps</span>:
      - <span class="pl-ent">name</span>: <span class="pl-s">Checkout</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">actions/checkout@v3</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Setup Node</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">actions/setup-node@v3</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">node-version</span>: <span class="pl-c1">16</span>
      <span class="pl-c"><span class="pl-c">#</span> 因为我的仓库使用的是pnpm，所以需要安装pnpm, 若使用的是npm则可以忽略。</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Install Pnpm</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">pnpm/action-setup@v2.2.2</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">version</span>: <span class="pl-s">6.0.2</span>
      <span class="pl-c"><span class="pl-c">#</span> 安装依赖，脚本(run部分)可以自己写</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Install dependencies</span>
        <span class="pl-ent">run</span>: <span class="pl-s">pnpm install</span>
      <span class="pl-c"><span class="pl-c">#</span> 可以使用prepublishOnly来做build, 这样build可以在ci环节中剔除。见下文Tips</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Build</span>
        <span class="pl-ent">run</span>: <span class="pl-s">pnpm run build</span>
      <span class="pl-c"><span class="pl-c">#</span> 使用JS-DevTools/npm-publish@v1来进行npm发布。</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Publish package on NPM 📦</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">JS-DevTools/npm-publish@v1</span>
        <span class="pl-ent">with</span>:
          <span class="pl-c"><span class="pl-c">#</span> token里的secrets.NPM_PUBLISH_TOKEN就是在仓库内设定的token名。</span>
          <span class="pl-ent">token</span>: <span class="pl-s">${{ secrets.NPM_PUBLISH_TOKEN }}</span></pre></div>
<h2 dir="auto">测试使用</h2>
<p dir="auto">在 github 仓库的<code class="notranslate">Releases</code>页面点击<code class="notranslate">Draft a new release</code><br>
在一个 release 发布后，会自动触发上文设置的 github action。</p>
<h2 dir="auto">Tips</h2>
<ul dir="auto">
<li>如果在<code class="notranslate">package.json</code>中设置了 <code class="notranslate">prepublishOnly</code>钩子去进行<code class="notranslate">build</code>操作，就无需在 action 中配置<code class="notranslate">npm run build</code>环节了。</li>
</ul>
<h2 dir="auto">Examples</h2>
<p dir="auto">参考：<a href="https://github.com/phshy0607/test-ci-auto-publish">https://github.com/phshy0607/test-ci-auto-publish</a></p></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"html":"\u003ch1 dir=\"auto\"\u003e使用 Github Action 自动发布 npm 包\u003c/h1\u003e\n\u003ch2 dir=\"auto\"\u003e简介\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e下午抽空调研了一下如何使用 github action 来自动发布 npm 包。写下本文记录。\u003c/p\u003e\n\u003ch2 dir=\"auto\"\u003e步骤\u003c/h2\u003e\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e准备 npm token\u003c/li\u003e\n\u003cli\u003e设置 github secret\u003c/li\u003e\n\u003cli\u003e设置 github actions\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 dir=\"auto\"\u003e准备 npm token\u003c/h2\u003e\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e访问\u003ca href=\"https://www.npmjs.com/\" rel=\"nofollow\"\u003ehttps://www.npmjs.com/\u003c/a\u003e 并登录。\u003c/li\u003e\n\u003cli\u003e进入个人设置 - access tokens。\u003c/li\u003e\n\u003cli\u003e选择\u003ccode class=\"notranslate\"\u003eGenerate New Token\u003c/code\u003e，输入密码确认。\u003c/li\u003e\n\u003cli\u003e给该 token 起个名字(名字不影响，为了方便记忆可以使用\u003ccode class=\"notranslate\"\u003enpm_publish\u003c/code\u003e这种)。并设置 token 类型为\u003ccode class=\"notranslate\"\u003eAutomation\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e记下该 token。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 dir=\"auto\"\u003e设置 github secret\u003c/h2\u003e\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e进入 github 仓库。\u003c/li\u003e\n\u003cli\u003e点击仓库的\u003ccode class=\"notranslate\"\u003eSettings - Actions\u003c/code\u003e，点击右上角的\u003ccode class=\"notranslate\"\u003eNew Repository Secret\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e输入 Token 名称，例如\u003ccode class=\"notranslate\"\u003eNPM_PUBLISH_TOKEN\u003c/code\u003e, 并填入之前在 npmjs.com 上创建的 npm token\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 dir=\"auto\"\u003e设置 github actions\u003c/h2\u003e\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e在仓库内新建\u003ccode class=\"notranslate\"\u003e.github/workflows/publish.yml\u003c/code\u003e文件\u003c/li\u003e\n\u003cli\u003e文件内容如下:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"name: Publish to NPM\non:\n  # release时触发。\n  release:\n    types: [created]\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v3\n      - name: Setup Node\n        uses: actions/setup-node@v3\n        with:\n          node-version: 16\n      # 因为我的仓库使用的是pnpm，所以需要安装pnpm, 若使用的是npm则可以忽略。\n      - name: Install Pnpm\n        uses: pnpm/action-setup@v2.2.2\n        with:\n          version: 6.0.2\n      # 安装依赖，脚本(run部分)可以自己写\n      - name: Install dependencies\n        run: pnpm install\n      # 可以使用prepublishOnly来做build, 这样build可以在ci环节中剔除。见下文Tips\n      - name: Build\n        run: pnpm run build\n      # 使用JS-DevTools/npm-publish@v1来进行npm发布。\n      - name: Publish package on NPM 📦\n        uses: JS-DevTools/npm-publish@v1\n        with:\n          # token里的secrets.NPM_PUBLISH_TOKEN就是在仓库内设定的token名。\n          token: ${{ secrets.NPM_PUBLISH_TOKEN }}\"\u003e\u003cpre\u003e\u003cspan class=\"pl-ent\"\u003ename\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003ePublish to NPM\u003c/span\u003e\n\u003cspan class=\"pl-ent\"\u003eon\u003c/span\u003e:\n  \u003cspan class=\"pl-c\"\u003e\u003cspan class=\"pl-c\"\u003e#\u003c/span\u003e release时触发。\u003c/span\u003e\n  \u003cspan class=\"pl-ent\"\u003erelease\u003c/span\u003e:\n    \u003cspan class=\"pl-ent\"\u003etypes\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e[created]\u003c/span\u003e\n\u003cspan class=\"pl-ent\"\u003ejobs\u003c/span\u003e:\n  \u003cspan class=\"pl-ent\"\u003ebuild\u003c/span\u003e:\n    \u003cspan class=\"pl-ent\"\u003eruns-on\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"pl-ent\"\u003esteps\u003c/span\u003e:\n      - \u003cspan class=\"pl-ent\"\u003ename\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003eCheckout\u003c/span\u003e\n        \u003cspan class=\"pl-ent\"\u003euses\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003eactions/checkout@v3\u003c/span\u003e\n      - \u003cspan class=\"pl-ent\"\u003ename\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003eSetup Node\u003c/span\u003e\n        \u003cspan class=\"pl-ent\"\u003euses\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003eactions/setup-node@v3\u003c/span\u003e\n        \u003cspan class=\"pl-ent\"\u003ewith\u003c/span\u003e:\n          \u003cspan class=\"pl-ent\"\u003enode-version\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003e16\u003c/span\u003e\n      \u003cspan class=\"pl-c\"\u003e\u003cspan class=\"pl-c\"\u003e#\u003c/span\u003e 因为我的仓库使用的是pnpm，所以需要安装pnpm, 若使用的是npm则可以忽略。\u003c/span\u003e\n      - \u003cspan class=\"pl-ent\"\u003ename\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003eInstall Pnpm\u003c/span\u003e\n        \u003cspan class=\"pl-ent\"\u003euses\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003epnpm/action-setup@v2.2.2\u003c/span\u003e\n        \u003cspan class=\"pl-ent\"\u003ewith\u003c/span\u003e:\n          \u003cspan class=\"pl-ent\"\u003eversion\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e6.0.2\u003c/span\u003e\n      \u003cspan class=\"pl-c\"\u003e\u003cspan class=\"pl-c\"\u003e#\u003c/span\u003e 安装依赖，脚本(run部分)可以自己写\u003c/span\u003e\n      - \u003cspan class=\"pl-ent\"\u003ename\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003eInstall dependencies\u003c/span\u003e\n        \u003cspan class=\"pl-ent\"\u003erun\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003epnpm install\u003c/span\u003e\n      \u003cspan class=\"pl-c\"\u003e\u003cspan class=\"pl-c\"\u003e#\u003c/span\u003e 可以使用prepublishOnly来做build, 这样build可以在ci环节中剔除。见下文Tips\u003c/span\u003e\n      - \u003cspan class=\"pl-ent\"\u003ename\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003eBuild\u003c/span\u003e\n        \u003cspan class=\"pl-ent\"\u003erun\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003epnpm run build\u003c/span\u003e\n      \u003cspan class=\"pl-c\"\u003e\u003cspan class=\"pl-c\"\u003e#\u003c/span\u003e 使用JS-DevTools/npm-publish@v1来进行npm发布。\u003c/span\u003e\n      - \u003cspan class=\"pl-ent\"\u003ename\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003ePublish package on NPM 📦\u003c/span\u003e\n        \u003cspan class=\"pl-ent\"\u003euses\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003eJS-DevTools/npm-publish@v1\u003c/span\u003e\n        \u003cspan class=\"pl-ent\"\u003ewith\u003c/span\u003e:\n          \u003cspan class=\"pl-c\"\u003e\u003cspan class=\"pl-c\"\u003e#\u003c/span\u003e token里的secrets.NPM_PUBLISH_TOKEN就是在仓库内设定的token名。\u003c/span\u003e\n          \u003cspan class=\"pl-ent\"\u003etoken\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e${{ secrets.NPM_PUBLISH_TOKEN }}\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 dir=\"auto\"\u003e测试使用\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e在 github 仓库的\u003ccode class=\"notranslate\"\u003eReleases\u003c/code\u003e页面点击\u003ccode class=\"notranslate\"\u003eDraft a new release\u003c/code\u003e\u003cbr\u003e\n在一个 release 发布后，会自动触发上文设置的 github action。\u003c/p\u003e\n\u003ch2 dir=\"auto\"\u003eTips\u003c/h2\u003e\n\u003cul dir=\"auto\"\u003e\n\u003cli\u003e如果在\u003ccode class=\"notranslate\"\u003epackage.json\u003c/code\u003e中设置了 \u003ccode class=\"notranslate\"\u003eprepublishOnly\u003c/code\u003e钩子去进行\u003ccode class=\"notranslate\"\u003ebuild\u003c/code\u003e操作，就无需在 action 中配置\u003ccode class=\"notranslate\"\u003enpm run build\u003c/code\u003e环节了。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 dir=\"auto\"\u003eExamples\u003c/h2\u003e\n\u003cp dir=\"auto\"\u003e参考：\u003ca href=\"https://github.com/phshy0607/test-ci-auto-publish\"\u003ehttps://github.com/phshy0607/test-ci-auto-publish\u003c/a\u003e\u003c/p\u003e"},"__N_SSG":true},"page":"/post/[id]","query":{"id":"35"},"buildId":"m0Bx2PmEL6WGIOdVS1quI","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>