<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="description" content="React Notion X Minimal Demo"/><title>理解 Node.js 的模块加载</title><meta name="next-head-count" content="4"/><link rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/blog/_next/static/css/e80d3da29db4d5c2.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/e80d3da29db4d5c2.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script defer="" src="/blog/_next/static/chunks/94b3d469.01f0b81f57fec31d.js"></script><script defer="" src="/blog/_next/static/chunks/78.e2fa1ad1735022d1.js"></script><script defer="" src="/blog/_next/static/chunks/785.f9522e486e3cf112.js"></script><script src="/blog/_next/static/chunks/webpack-c10d1318d0451db8.js" defer=""></script><script src="/blog/_next/static/chunks/framework-459f2affe0a6a60f.js" defer=""></script><script src="/blog/_next/static/chunks/main-12dc9115bd27a2f8.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-ca60221c825fc339.js" defer=""></script><script src="/blog/_next/static/chunks/571-e33bda93c073246d.js" defer=""></script><script src="/blog/_next/static/chunks/pages/%5BpageId%5D-c9611068cade4702.js" defer=""></script><script src="/blog/_next/static/LPY4J0ojF6qd7z1Lg7Iy6/_buildManifest.js" defer=""></script><script src="/blog/_next/static/LPY4J0ojF6qd7z1Lg7Iy6/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="notion notion-app light-mode notion-block-129181e55b2d40a5af6047c125f075fd"><div class="notion-viewport"></div><div class="notion-frame"><header class="notion-header"><div class="notion-nav-header"><div class="breadcrumbs"><a class="breadcrumb" href="/blog/35a3a4f93d7a4cb89e0f18ed63907dcf"><div class="notion-page-icon-inline notion-page-icon-span"><img class="icon notion-page-icon" src="https://www.notion.so/icons/glasses_red.svg?mode=light" alt="Citrus327’s Blog" loading="lazy" decoding="async"/></div><span class="title">Citrus327’s Blog</span></a><span class="spacer">/</span><div class="breadcrumb active"><span class="title">理解 Node.js 的模块加载</span></div></div></div></header><div class="notion-page-scroller"><main class="notion-page notion-page-no-cover notion-page-no-icon notion-page-has-text-icon notion-full-page"><h1 class="notion-title">理解 Node.js 的模块加载</h1><!--$--><div class="notion-collection-page-properties"><div class="notion-collection-row"><div class="notion-collection-row-body"></div></div></div><!--/$--><div class="notion-page-content"><article class="notion-page-content-inner"><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-bba6b8be52da4cc99c109c531a392c20" data-id="bba6b8be52da4cc99c109c531a392c20"><span><div id="bba6b8be52da4cc99c109c531a392c20" class="notion-header-anchor"></div><a class="notion-hash-link" href="#bba6b8be52da4cc99c109c531a392c20" title="理解 Node.js 的模块加载"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">理解 Node.js 的模块加载</span></span></h2><blockquote class="notion-quote notion-block-9ddf148e548d4eedb5427f57fe3784a2"><div>本文为阅读深入浅出 Node.js（三）：深入 Node.js 的模块机制&gt;之后的总结。作为日常的知识储备，方便日后查看和消化。</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-ca96a1ccd9294bab827a661d61ae3322" data-id="ca96a1ccd9294bab827a661d61ae3322"><span><div id="ca96a1ccd9294bab827a661d61ae3322" class="notion-header-anchor"></div><a class="notion-hash-link" href="#ca96a1ccd9294bab827a661d61ae3322" title="起因"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">起因</span></span></h3><div class="notion-text notion-block-6916e5fdf7714fb9aa86fd13e2b2536c">JavaScript 本来并没有模块化这一说，作为一种脚本语言却缺少模块化实现就很难在此之上有所拓展。<a target="_blank" rel="noopener noreferrer" class="notion-link" href="http://www.commonjs.org/">CommonJs</a>规范的出现改变了这一点，其最终目标是拓展 JavaScript 的生态范围。Node.js 实现了 CommonJs 的模块引入规范，NPM 实现了包规范。两者契合就有了现在的 Node.js 模块化。</div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-b328a550fb534f67b3852f19f6abfc50" data-id="b328a550fb534f67b3852f19f6abfc50"><span><div id="b328a550fb534f67b3852f19f6abfc50" class="notion-header-anchor"></div><a class="notion-hash-link" href="#b328a550fb534f67b3852f19f6abfc50" title="模块载入策略"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">模块载入策略</span></span></h3><div class="notion-text notion-block-68a88724e9b24ea796e2ee472e3de74c">原生模块和文件模块都有模块缓存一说，在载入某模块之后，会缓存起来待之后使用。</div><h4 class="notion-h notion-h3 notion-h-indent-2 notion-block-ed5c5d9e4e8d4b498f995b10acc6136d" data-id="ed5c5d9e4e8d4b498f995b10acc6136d"><span><div id="ed5c5d9e4e8d4b498f995b10acc6136d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#ed5c5d9e4e8d4b498f995b10acc6136d" title="文件模块"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">文件模块</span></span></h4><div class="notion-text notion-block-ec7297f7020f411f90d3cbe898a97d83">这种很常见，因为最基本的命令 <code class="notion-inline-code">node app.js</code> 就是直接将 app.js 作为文件模块引入执行。加载文件模块是由原生模块<code class="notion-inline-code">Module</code>去完成的，该原生模块在启动时已经被加载。</div><!--$--><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-javascript">// bootstrap main module.
Module.runMain = function () {
  // Load the main module--the command line argument.
  Module._load(process.argv[1], null, true);
};</code></pre><!--/$--><div class="notion-text notion-block-94ab16151f7745bf915af0e2371e5a35"><code class="notion-inline-code">Module._load</code>静态方法在分析文件名之后，会创建对应 Module</div><!--$--><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-javascript">var module = new Module(id, parent);</code></pre><!--/$--><div class="notion-text notion-block-3c325c4144fe41b69eed1fd2937307ab">这里举的例子是用 <code class="notion-inline-code">app.js</code> 为例的，Node.js 支持 3 类文件的解析，分别是 <code class="notion-inline-code">.js</code> <code class="notion-inline-code">.json</code> <code class="notion-inline-code">.node</code></div><div class="notion-text notion-block-3fb1e3121fa741d4b77e18d0e40d1d4f">Node.js 会用一个闭包函数去包装引用文件的内容</div><!--$--><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-javascript">(function (exports, require, module, __filename, __dirname) {
  // Your file content
});</code></pre><!--/$--><div class="notion-text notion-block-137a980dcb924336b83f8cf192807a15">这也是为什么 Node.js 的模块内，会有类似全局变量的<code class="notion-inline-code">require</code> <code class="notion-inline-code">module</code> <code class="notion-inline-code">export</code> <code class="notion-inline-code">__dirname</code>的存在</div><h4 class="notion-h notion-h3 notion-h-indent-2 notion-block-4b40ed18bd0c4ee8b442b58f357ec466" data-id="4b40ed18bd0c4ee8b442b58f357ec466"><span><div id="4b40ed18bd0c4ee8b442b58f357ec466" class="notion-header-anchor"></div><a class="notion-hash-link" href="#4b40ed18bd0c4ee8b442b58f357ec466" title="模块查找优先级"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">模块查找优先级</span></span></h4><div class="notion-text notion-block-63c5215e829346209e6741d14c0bd303">在说载入 Node.js 原生模块之前，先说明一下 require 的模块查找优先级</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-a92f40dddfa74689ba3d3431c911d0b7"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><img src="https://www.notion.so/image/https%3A%2F%2Fstatic001.infoq.cn%2Fresource%2Fimage%2F85%2F65%2F851bca4acc603ce08d1011243191f665.jpg?table=block&amp;id=a92f40dd-dfa7-4689-ba3d-3431c911d0b7&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-text notion-block-58b24fde67684ebcadb5e679981ee8df">require的模块查找策略</div><h4 class="notion-h notion-h3 notion-h-indent-2 notion-block-83c70616ae024839884c991b0ed8dae7" data-id="83c70616ae024839884c991b0ed8dae7"><span><div id="83c70616ae024839884c991b0ed8dae7" class="notion-header-anchor"></div><a class="notion-hash-link" href="#83c70616ae024839884c991b0ed8dae7" title="原生模块"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">原生模块</span></span></h4><div class="notion-text notion-block-77855a5a2bb34c43a9767fe0ef5f8ff9">Node.js 含有很多原生模块，例如 http, fs, path 等。 看这个图中会发现，如果目标模块在文件缓存区，原生模块的载入优先级会在文件缓存区之后。</div><div class="notion-text notion-block-0ca1f3f55deb41e6890f93909fb86c6c">也就是说如果你有一个 http.js，如果这个文件先被引入（即载入文件缓存区），在之后执行<code class="notion-inline-code">require(&#x27;http&#x27;)</code>会直接引入文件而非 Node.js 原生模块。</div><div class="notion-text notion-block-ca4af7e4072c4bd0b1df25eafc8bd92d">其实这个场景不会存在，在 Node.js 环境下，引入文件肯定会是用文件的 path，哪怕运行入口和 http.js 在同级，也就是说</div><!--$--><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-javascript">const http = require(&quot;http&quot;);</code></pre><!--/$--><div class="notion-text notion-block-65bd469c225c44c1be4c7fc945e48664">这个肯定会载入原生模块，文件的引入是用</div><!--$--><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-javascript">const httpFile = require(&quot;./http&quot;);</code></pre><!--/$--><div class="notion-text notion-block-9898c24c28d04294b8c31a4612f545bd">所以不用担心会有同名的文件模块和原生模块。</div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-a31a78c3f4ee48929ba66a40c7a9aaba" data-id="a31a78c3f4ee48929ba66a40c7a9aaba"><span><div id="a31a78c3f4ee48929ba66a40c7a9aaba" class="notion-header-anchor"></div><a class="notion-hash-link" href="#a31a78c3f4ee48929ba66a40c7a9aaba" title="模块查找策略"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">模块查找策略</span></span></h3><div class="notion-text notion-block-273a03ce8c1844ffa87d7ed0c55db61c">如果使用 require 去引入一个模块，其查找优先级是</div><ol start="1" class="notion-list notion-list-numbered notion-block-a8fc38aeb9334f968d130f7f462accb6"><li>从当前文件目录开始查找 node_modules 目录</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-4e6f7edd4c2d4936b8250d9ef504fe4c"><li>然后依次进入父目录，查找父目录下的 node_modules 目录</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-ae1ff4d97c5e4056b57e62597791e0f7"><li>依次迭代，直到根目录下的 node_modules 目录</li></ol><div class="notion-text notion-block-0f88bbb409eb478f82b84afd27185875">如下代码可以在 Node.js 的环境下使用，这个 module.path 就是查找的顺序</div><!--$--><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-javascript">console.log(module.paths);
// 输出
[
  &quot;/Users/hao/Work/github/node_module_test/node_modules&quot;,
  &quot;/Users/hao/Work/github/node_modules&quot;,
  &quot;/Users/hao/Work/node_modules&quot;,
  &quot;/Users/hao/node_modules&quot;,
  &quot;/Users/node_modules&quot;,
  &quot;/node_modules&quot;,
];</code></pre><!--/$--><div class="notion-text notion-block-fa51b44b7e34431ebf8c786de50faaef">结合之前的图示，完整的策略为：</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-3cc199013f7c4ce296d3c8959bb82ca7"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><img src="https://www.notion.so/image/https%3A%2F%2Fstatic001.infoq.cn%2Fresource%2Fimage%2F14%2Fcb%2F1416ddabad3dcd4ffca600f88a7613cb.jpg?table=block&amp;id=3cc19901-3f7c-4ce2-96d3-c8959bb82ca7&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-text notion-block-dda699e94ef64a3f8e4e6111c27001f2">模块查找策略</div><div class="notion-text notion-block-57c4a9208ce94dacaf5983ac66f8738d">简而言之，如果 require 绝对路径的文件，查找时不会去遍历每一个 node_modules 目录，其速度最快。其余流程如下：</div><ol start="1" class="notion-list notion-list-numbered notion-block-06447a0b52964755a20b36c2d3f35633"><li>从 module path 数组中取出第一个目录作为查找基准。</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-8d160b62edeb4340864fe5ca60626a98"><li>直接从目录中查找该文件，如果存在，则结束查找。如果不存在，则进行下一条查找。</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-326555dfb10c4efab6a073c02a6c602b"><li>尝试添加.js、.json、.node 后缀后查找，如果存在文件，则结束查找。如果不存在，则进行下一条。</li></ol><ol start="4" class="notion-list notion-list-numbered notion-block-53b0ea3292854098a9dc07270185c927"><li>尝试将 require 的参数作为一个包来进行查找，读取目录下的 package.json 文件，取得 main 参数指定的文件。</li></ol><ol start="5" class="notion-list notion-list-numbered notion-block-1c73a8a478124b43b448aa8ee1568362"><li>尝试查找该文件，如果存在，则结束查找。如果不存在，则进行第 3 条查找。</li></ol><ol start="6" class="notion-list notion-list-numbered notion-block-6294c8082da64932abfecab16570126b"><li>如果继续失败，则取出 module path 数组中的下一个目录作为基准查找，循环第 1 至 5 个步骤。</li></ol><ol start="7" class="notion-list notion-list-numbered notion-block-4d4a69617a7e43ca9ed66d075218482b"><li>如果继续失败，循环第 1 至 6 个步骤，直到 module path 中的最后一个值。</li></ol><ol start="8" class="notion-list notion-list-numbered notion-block-c6e4b4c1983e460a853c4bac0913a755"><li>如果仍然失败，则抛出异常。</li></ol><div class="notion-text notion-block-27656235e9034506994b38a87e33a790">整个查找过程十分类似原型链的查找和作用域的查找。所幸 Node.js 对路径查找实现了缓存机制，否则由于每次判断路径都是同步阻塞式进行，会导致严重的性能消耗。</div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-160e1304f02948ee88a7f9cbb88fc961" data-id="160e1304f02948ee88a7f9cbb88fc961"><span><div id="160e1304f02948ee88a7f9cbb88fc961" class="notion-header-anchor"></div><a class="notion-hash-link" href="#160e1304f02948ee88a7f9cbb88fc961" title="CommonJs 包规范"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">CommonJs 包规范</span></span></h3><div class="notion-text notion-block-5f6378de867b4f9c801cf43da0ecc6b0">一个符合 CommonJS 规范的包应该是如下这种结构：</div><ol start="1" class="notion-list notion-list-numbered notion-block-311cca20318942a796aff19a1d5fbcf0"><li>一个 package.json 文件应该存在于包顶级目录下</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-ec8b4fb099494d63a7200b3f3cd71978"><li>二进制文件应该包含在 bin 目录下。</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-045448c98e3d4664bd09bcf83f31a176"><li>JavaScript 代码应该包含在 lib 目录下。</li></ol><ol start="4" class="notion-list notion-list-numbered notion-block-2a62705f86814a01a804e47a3931a21c"><li>文档应该在 doc 目录下。</li></ol><ol start="5" class="notion-list notion-list-numbered notion-block-78305cce962c4aaaaf22f016c10e5451"><li>单元测试应该在 test 目录下。</li></ol><div class="notion-text notion-block-f39cd879de444cd4a0a48e14f2e85d69">根据上文说的查找逻辑，其实很重要的一点就是 package.json 里的 main 字段。 这个定义了包的入口文件所在。</div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-eacc1bf1569c4a2e8451dc3d9929e827" data-id="eacc1bf1569c4a2e8451dc3d9929e827"><span><div id="eacc1bf1569c4a2e8451dc3d9929e827" class="notion-header-anchor"></div><a class="notion-hash-link" href="#eacc1bf1569c4a2e8451dc3d9929e827" title="为何有些模块可以在 Node.js 运行也可以在浏览器端运行"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">为何有些模块可以在 Node.js 运行也可以在浏览器端运行</span></span></h3><div class="notion-text notion-block-827ab5ed0a814504af656f6b1a8e2df3">浏览器端的 Js 代码都是通过 script 标签引入并执行。</div><div class="notion-text notion-block-0dc040c3a84449ce95b8ca5687cd3bd3">Node.js 是会通过上文中提到的闭包函数去进行包装</div><!--$--><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-javascript">(function (exports, require, module, __filename, __dirname) {
  // Your file content
});</code></pre><!--/$--><div class="notion-text notion-block-639fcc6e55bb44d184a4c34a5301d05b">Node.js 由于是个闭包，所以不会污染全局变量。浏览器端则不然。 有些包可以在 Node.js 和浏览器端运行，也是利用闭包和变量检测去完成模块的解析和运行的。 例如著名类库 underscore 的定义方式</div><!--$--><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-javascript">(function () {
  // Establish the root object, `window` in the browser, or `global` on the server.
  var root = this;
  var _ = function (obj) {
    return new wrapper(obj);
  };
  if (typeof exports !== &quot;undefined&quot;) {
    if (typeof module !== &quot;undefined&quot; &amp;&amp; module.exports) {
      exports = module.exports = _;
    }
    exports._ = _;
  } else if (typeof define === &quot;function&quot; &amp;&amp; define.amd) {
    // Register as a named module with AMD.
    define(&quot;underscore&quot;, function () {
      return _;
    });
  } else {
    root[&quot;_&quot;] = _;
  }
}.call(this));</code></pre><!--/$--><div class="notion-text notion-block-be99dc4cb9c049e4998fe2d29240e05f">以上代码优先检测了 exports 是否存在，也就是 CommonJs 规范，如果存在 exports 对象，直接将目标对象定义在 exports 上。</div><div class="notion-text notion-block-33465ab98acb45f6af4113ed7d48e3a1">然后检测了 define 是否存在，这是 amd 的模块规范，以适配 amd 的模块规范。</div><div class="notion-text notion-block-87a056e9c289466196c709a946ff8809">最终如果检测不到 CommonJs 和 AMD 的运行环境，则认为是在一个沙盒内运行。</div><div class="notion-text notion-block-46ded542954749068bcb806b1f3300b1">可以看到第一行的<code class="notion-inline-code">var root = this</code>，这个 this 在浏览器端即为 window。也就是说如果运行环境既不是 CommmonJs 也不是 AMD，则直接挂在 window 对象下。</div><div class="notion-text notion-block-ea519ed192ca4bdfa8cef6bc509763e5">现在很多的打包工具都会根据打包的 target（UMD, CommonJs 等）进行 build, 会自动的拼接这些判断，所以其实日常开发 js 插件/模块，是不需要担心这些环境检测的代码的。</div></article></div></main></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"recordMap":{"block":{"129181e5-5b2d-40a5-af60-47c125f075fd":{"role":"reader","value":{"id":"129181e5-5b2d-40a5-af60-47c125f075fd","version":12,"type":"page","properties":{"title":[["理解 Node.js 的模块加载"]]},"content":["bba6b8be-52da-4cc9-9c10-9c531a392c20","9ddf148e-548d-4eed-b542-7f57fe3784a2","ca96a1cc-d929-4bab-827a-661d61ae3322","6916e5fd-f771-4fb9-aa86-fd13e2b2536c","b328a550-fb53-4f67-b385-2f19f6abfc50","68a88724-e9b2-4ea7-96e2-ee472e3de74c","ed5c5d9e-4e8d-4b49-8f99-5b10acc6136d","ec7297f7-020f-411f-90d3-cbe898a97d83","4f3b2e99-670a-4329-acb8-7cb384a64661","94ab1615-1f77-45bf-915a-f0e2371e5a35","3b5699fe-8e81-4595-9440-868641a36202","3c325c41-44fe-41b6-9eed-1fd2937307ab","3fb1e312-1fa7-41d4-b77e-18d0e40d1d4f","6e355402-78c8-48fe-94c6-f6f440861068","137a980d-cb92-4336-b83f-8cf192807a15","4b40ed18-bd0c-4ee8-b442-b58f357ec466","63c5215e-8293-4620-9e67-41d14c0bd303","a92f40dd-dfa7-4689-ba3d-3431c911d0b7","58b24fde-6768-4ebc-adb5-e679981ee8df","83c70616-ae02-4839-884c-991b0ed8dae7","77855a5a-2bb3-4c43-a976-7fe0ef5f8ff9","0ca1f3f5-5deb-41e6-890f-93909fb86c6c","ca4af7e4-072c-4bd0-b1df-25eafc8bd92d","da16f409-b7b3-4cc4-8fe9-216adc2c1fe3","65bd469c-225c-44c1-be4c-7fc945e48664","a82cb9ae-a823-480e-ba38-aa920b222f72","9898c24c-28d0-4294-b8c3-1a4612f545bd","a31a78c3-f4ee-4892-9ba6-6a40c7a9aaba","273a03ce-8c18-44ff-a87d-7ed0c55db61c","a8fc38ae-b933-4f96-8d13-0f7f462accb6","4e6f7edd-4c2d-4936-b825-0d9ef504fe4c","ae1ff4d9-7c5e-4056-b57e-62597791e0f7","0f88bbb4-09eb-478f-82b8-4afd27185875","b087a35d-a1cf-4996-9e1f-ed8135f97531","fa51b44b-7e34-431e-bf8c-786de50faaef","3cc19901-3f7c-4ce2-96d3-c8959bb82ca7","dda699e9-4ef6-4a3f-8e4e-6111c27001f2","57c4a920-8ce9-4dac-af59-83ac66f8738d","06447a0b-5296-4755-a20b-36c2d3f35633","8d160b62-edeb-4340-864f-e5ca60626a98","326555df-b10c-4efa-b6a0-73c02a6c602b","53b0ea32-9285-4098-a9dc-07270185c927","1c73a8a4-7812-4b43-b448-aa8ee1568362","6294c808-2da6-4932-abfe-cab16570126b","4d4a6961-7a7e-43ca-9ed6-6d075218482b","c6e4b4c1-983e-460a-853c-4bac0913a755","27656235-e903-4506-994b-38a87e33a790","160e1304-f029-48ee-88a7-f9cbb88fc961","5f6378de-867b-4f9c-801c-f43da0ecc6b0","311cca20-3189-42a7-96af-f19a1d5fbcf0","ec8b4fb0-9949-4d63-a720-0b3f3cd71978","045448c9-8e3d-4664-bd09-bcf83f31a176","2a62705f-8681-4a01-a804-e47a3931a21c","78305cce-962c-4aaa-af22-f016c10e5451","f39cd879-de44-4cd4-a0a4-8e14f2e85d69","eacc1bf1-569c-4a2e-8451-dc3d9929e827","827ab5ed-0a81-4504-af65-6f6b1a8e2df3","0dc040c3-a844-49ce-95b8-ca5687cd3bd3","6d28e0fa-7cc7-481a-a386-32cd857d9e2b","639fcc6e-55bb-44d1-84a4-c34a5301d05b","271821ef-6cee-42a0-8efb-244c189e6799","be99dc4c-b9c0-49e4-998f-e2d29240e05f","33465ab9-8acb-45f6-af41-13ed7d48e3a1","87a056e9-c289-4661-96c7-09a946ff8809","46ded542-9547-4906-8bcb-806b1f3300b1","ea519ed1-92ca-4bdf-a8ce-f6bc509763e5"],"created_time":1673275148796,"last_edited_time":1673276759943,"parent_id":"7c5b4e39-cf12-4d8c-986c-cff290eee407","parent_table":"collection","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"720fa796-e2d6-42db-ac52-1fee3d19addd":{"role":"reader","value":{"id":"720fa796-e2d6-42db-ac52-1fee3d19addd","version":138,"type":"collection_view","view_ids":["97e7d4c0-30d1-4f1c-a393-bb0306148ce7","c5d58f05-b0cc-4b2b-b545-f1fd5df549fb"],"collection_id":"7c5b4e39-cf12-4d8c-986c-cff290eee407","format":{"block_locked":true,"block_locked_by":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","collection_pointer":{"id":"7c5b4e39-cf12-4d8c-986c-cff290eee407","table":"collection","spaceId":"11f66c5f-6043-406b-b492-4dc267645668"},"page_cover_position":0.6},"created_time":1673273881211,"last_edited_time":1673609816936,"parent_id":"35a3a4f9-3d7a-4cb8-9e0f-18ed63907dcf","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"35a3a4f9-3d7a-4cb8-9e0f-18ed63907dcf":{"role":"reader","value":{"id":"35a3a4f9-3d7a-4cb8-9e0f-18ed63907dcf","version":270,"type":"page","properties":{"title":[["Citrus327’s Blog"]]},"content":["aa6b97de-ddd6-4b90-988f-e783bc91bd90","720fa796-e2d6-42db-ac52-1fee3d19addd","1e734c6c-9054-4c36-b6dc-a3ec045eaa2b"],"format":{"page_icon":"/icons/glasses_red.svg","page_cover":"/images/page-cover/solid_yellow.png","copied_from_pointer":{"id":"78754261-97cf-4616-9880-9def95960ebf","table":"block","spaceId":"fde5ac74-eea3-4527-8f00-4482710e1af3"},"page_cover_position":0.6},"permissions":[{"role":"editor","type":"user_permission","user_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a"},{"role":"reader","type":"public_permission","added_timestamp":1673037428832}],"created_time":1673036763269,"last_edited_time":1673609823777,"parent_id":"11f66c5f-6043-406b-b492-4dc267645668","parent_table":"space","alive":true,"copied_from":"78754261-97cf-4616-9880-9def95960ebf","file_ids":["f70d3dc6-ce97-4be2-9cde-b86606147b41","a2bd3317-78e4-48bc-8d27-9b733175a416","747fe148-54f4-48ba-b7c0-dfb2bf5b9b96","ff661d2b-c27d-4552-9892-477f2d7b33b9"],"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"bba6b8be-52da-4cc9-9c10-9c531a392c20":{"role":"reader","value":{"id":"bba6b8be-52da-4cc9-9c10-9c531a392c20","version":1,"type":"header","properties":{"title":[["理解 Node.js 的模块加载"]]},"created_time":1673275148757,"last_edited_time":1673275148757,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"9ddf148e-548d-4eed-b542-7f57fe3784a2":{"role":"reader","value":{"id":"9ddf148e-548d-4eed-b542-7f57fe3784a2","version":1,"type":"quote","properties":{"title":[["本文为阅读深入浅出 Node.js（三）：深入 Node.js 的模块机制\u003e之后的总结。作为日常的知识储备，方便日后查看和消化。"]]},"created_time":1673275148761,"last_edited_time":1673275148761,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"ca96a1cc-d929-4bab-827a-661d61ae3322":{"role":"reader","value":{"id":"ca96a1cc-d929-4bab-827a-661d61ae3322","version":1,"type":"sub_header","properties":{"title":[["起因"]]},"created_time":1673275148761,"last_edited_time":1673275148761,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"6916e5fd-f771-4fb9-aa86-fd13e2b2536c":{"role":"reader","value":{"id":"6916e5fd-f771-4fb9-aa86-fd13e2b2536c","version":1,"type":"text","properties":{"title":[["JavaScript 本来并没有模块化这一说，作为一种脚本语言却缺少模块化实现就很难在此之上有所拓展。"],["CommonJs",[["a","http://www.commonjs.org/"]]],["规范的出现改变了这一点，其最终目标是拓展 JavaScript 的生态范围。Node.js 实现了 CommonJs 的模块引入规范，NPM 实现了包规范。两者契合就有了现在的 Node.js 模块化。"]]},"created_time":1673275148764,"last_edited_time":1673275148764,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"b328a550-fb53-4f67-b385-2f19f6abfc50":{"role":"reader","value":{"id":"b328a550-fb53-4f67-b385-2f19f6abfc50","version":1,"type":"sub_header","properties":{"title":[["模块载入策略"]]},"created_time":1673275148764,"last_edited_time":1673275148764,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"68a88724-e9b2-4ea7-96e2-ee472e3de74c":{"role":"reader","value":{"id":"68a88724-e9b2-4ea7-96e2-ee472e3de74c","version":1,"type":"text","properties":{"title":[["原生模块和文件模块都有模块缓存一说，在载入某模块之后，会缓存起来待之后使用。"]]},"created_time":1673275148764,"last_edited_time":1673275148764,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"ed5c5d9e-4e8d-4b49-8f99-5b10acc6136d":{"role":"reader","value":{"id":"ed5c5d9e-4e8d-4b49-8f99-5b10acc6136d","version":1,"type":"sub_sub_header","properties":{"title":[["文件模块"]]},"created_time":1673275148765,"last_edited_time":1673275148765,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"ec7297f7-020f-411f-90d3-cbe898a97d83":{"role":"reader","value":{"id":"ec7297f7-020f-411f-90d3-cbe898a97d83","version":1,"type":"text","properties":{"title":[["这种很常见，因为最基本的命令 "],["node app.js",[["c"]]],[" 就是直接将 app.js 作为文件模块引入执行。加载文件模块是由原生模块"],["Module",[["c"]]],["去完成的，该原生模块在启动时已经被加载。"]]},"created_time":1673275148765,"last_edited_time":1673275148765,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"4f3b2e99-670a-4329-acb8-7cb384a64661":{"role":"reader","value":{"id":"4f3b2e99-670a-4329-acb8-7cb384a64661","version":13,"type":"code","properties":{"title":[["// bootstrap main module.\nModule.runMain = function () {\n  // Load the main module--the command line argument.\n  Module._load(process.argv[1], null, true);\n};"]],"language":[["JavaScript"]]},"format":{"code_wrap":true},"created_time":1673275148766,"last_edited_time":1673276289754,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"94ab1615-1f77-45bf-915a-f0e2371e5a35":{"role":"reader","value":{"id":"94ab1615-1f77-45bf-915a-f0e2371e5a35","version":1,"type":"text","properties":{"title":[["Module._load",[["c"]]],["静态方法在分析文件名之后，会创建对应 Module"]]},"created_time":1673275148767,"last_edited_time":1673275148767,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"3b5699fe-8e81-4595-9440-868641a36202":{"role":"reader","value":{"id":"3b5699fe-8e81-4595-9440-868641a36202","version":3,"type":"code","properties":{"title":[["var module = new Module(id, parent);"]],"language":[["JavaScript"]]},"format":{"code_wrap":true},"created_time":1673275148767,"last_edited_time":1673276296373,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"3c325c41-44fe-41b6-9eed-1fd2937307ab":{"role":"reader","value":{"id":"3c325c41-44fe-41b6-9eed-1fd2937307ab","version":1,"type":"text","properties":{"title":[["这里举的例子是用 "],["app.js",[["c"]]],[" 为例的，Node.js 支持 3 类文件的解析，分别是 "],[".js",[["c"]]],[" "],[".json",[["c"]]],[" "],[".node",[["c"]]]]},"created_time":1673275148768,"last_edited_time":1673275148768,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"3fb1e312-1fa7-41d4-b77e-18d0e40d1d4f":{"role":"reader","value":{"id":"3fb1e312-1fa7-41d4-b77e-18d0e40d1d4f","version":1,"type":"text","properties":{"title":[["Node.js 会用一个闭包函数去包装引用文件的内容"]]},"created_time":1673275148768,"last_edited_time":1673275148768,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"6e355402-78c8-48fe-94c6-f6f440861068":{"role":"reader","value":{"id":"6e355402-78c8-48fe-94c6-f6f440861068","version":6,"type":"code","properties":{"title":[["(function (exports, require, module, __filename, __dirname) {\n  // Your file content\n});"]],"language":[["JavaScript"]]},"format":{"code_wrap":true},"created_time":1673275148768,"last_edited_time":1673276303480,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"137a980d-cb92-4336-b83f-8cf192807a15":{"role":"reader","value":{"id":"137a980d-cb92-4336-b83f-8cf192807a15","version":1,"type":"text","properties":{"title":[["这也是为什么 Node.js 的模块内，会有类似全局变量的"],["require",[["c"]]],[" "],["module",[["c"]]],[" "],["export",[["c"]]],[" "],["__dirname",[["c"]]],["的存在"]]},"created_time":1673275148769,"last_edited_time":1673275148769,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"4b40ed18-bd0c-4ee8-b442-b58f357ec466":{"role":"reader","value":{"id":"4b40ed18-bd0c-4ee8-b442-b58f357ec466","version":1,"type":"sub_sub_header","properties":{"title":[["模块查找优先级"]]},"created_time":1673275148769,"last_edited_time":1673275148769,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"63c5215e-8293-4620-9e67-41d14c0bd303":{"role":"reader","value":{"id":"63c5215e-8293-4620-9e67-41d14c0bd303","version":1,"type":"text","properties":{"title":[["在说载入 Node.js 原生模块之前，先说明一下 require 的模块查找优先级"]]},"created_time":1673275148770,"last_edited_time":1673275148770,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"a92f40dd-dfa7-4689-ba3d-3431c911d0b7":{"role":"reader","value":{"id":"a92f40dd-dfa7-4689-ba3d-3431c911d0b7","version":1,"type":"image","properties":{"source":[["https://static001.infoq.cn/resource/image/85/65/851bca4acc603ce08d1011243191f665.jpg"]]},"created_time":1673275148770,"last_edited_time":1673275148770,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"58b24fde-6768-4ebc-adb5-e679981ee8df":{"role":"reader","value":{"id":"58b24fde-6768-4ebc-adb5-e679981ee8df","version":1,"type":"text","properties":{"title":[["require的模块查找策略"]]},"created_time":1673275148771,"last_edited_time":1673275148771,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"83c70616-ae02-4839-884c-991b0ed8dae7":{"role":"reader","value":{"id":"83c70616-ae02-4839-884c-991b0ed8dae7","version":1,"type":"sub_sub_header","properties":{"title":[["原生模块"]]},"created_time":1673275148771,"last_edited_time":1673275148771,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"77855a5a-2bb3-4c43-a976-7fe0ef5f8ff9":{"role":"reader","value":{"id":"77855a5a-2bb3-4c43-a976-7fe0ef5f8ff9","version":1,"type":"text","properties":{"title":[["Node.js 含有很多原生模块，例如 http, fs, path 等。 看这个图中会发现，如果目标模块在文件缓存区，原生模块的载入优先级会在文件缓存区之后。"]]},"created_time":1673275148771,"last_edited_time":1673275148771,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"0ca1f3f5-5deb-41e6-890f-93909fb86c6c":{"role":"reader","value":{"id":"0ca1f3f5-5deb-41e6-890f-93909fb86c6c","version":1,"type":"text","properties":{"title":[["也就是说如果你有一个 http.js，如果这个文件先被引入（即载入文件缓存区），在之后执行"],["require('http')",[["c"]]],["会直接引入文件而非 Node.js 原生模块。"]]},"created_time":1673275148772,"last_edited_time":1673275148772,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"ca4af7e4-072c-4bd0-b1df-25eafc8bd92d":{"role":"reader","value":{"id":"ca4af7e4-072c-4bd0-b1df-25eafc8bd92d","version":1,"type":"text","properties":{"title":[["其实这个场景不会存在，在 Node.js 环境下，引入文件肯定会是用文件的 path，哪怕运行入口和 http.js 在同级，也就是说"]]},"created_time":1673275148773,"last_edited_time":1673275148773,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"da16f409-b7b3-4cc4-8fe9-216adc2c1fe3":{"role":"reader","value":{"id":"da16f409-b7b3-4cc4-8fe9-216adc2c1fe3","version":3,"type":"code","properties":{"title":[["const http = require(\"http\");"]],"language":[["JavaScript"]]},"format":{"code_wrap":true},"created_time":1673275148773,"last_edited_time":1673276308130,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"65bd469c-225c-44c1-be4c-7fc945e48664":{"role":"reader","value":{"id":"65bd469c-225c-44c1-be4c-7fc945e48664","version":1,"type":"text","properties":{"title":[["这个肯定会载入原生模块，文件的引入是用"]]},"created_time":1673275148773,"last_edited_time":1673275148773,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"a82cb9ae-a823-480e-ba38-aa920b222f72":{"role":"reader","value":{"id":"a82cb9ae-a823-480e-ba38-aa920b222f72","version":3,"type":"code","properties":{"title":[["const httpFile = require(\"./http\");"]],"language":[["JavaScript"]]},"format":{"code_wrap":true},"created_time":1673275148774,"last_edited_time":1673276311210,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"9898c24c-28d0-4294-b8c3-1a4612f545bd":{"role":"reader","value":{"id":"9898c24c-28d0-4294-b8c3-1a4612f545bd","version":1,"type":"text","properties":{"title":[["所以不用担心会有同名的文件模块和原生模块。"]]},"created_time":1673275148774,"last_edited_time":1673275148774,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"a31a78c3-f4ee-4892-9ba6-6a40c7a9aaba":{"role":"reader","value":{"id":"a31a78c3-f4ee-4892-9ba6-6a40c7a9aaba","version":1,"type":"sub_header","properties":{"title":[["模块查找策略"]]},"created_time":1673275148774,"last_edited_time":1673275148774,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"273a03ce-8c18-44ff-a87d-7ed0c55db61c":{"role":"reader","value":{"id":"273a03ce-8c18-44ff-a87d-7ed0c55db61c","version":1,"type":"text","properties":{"title":[["如果使用 require 去引入一个模块，其查找优先级是"]]},"created_time":1673275148775,"last_edited_time":1673275148775,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"a8fc38ae-b933-4f96-8d13-0f7f462accb6":{"role":"reader","value":{"id":"a8fc38ae-b933-4f96-8d13-0f7f462accb6","version":1,"type":"numbered_list","properties":{"title":[["从当前文件目录开始查找 node_modules 目录"]]},"created_time":1673275148775,"last_edited_time":1673275148775,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"4e6f7edd-4c2d-4936-b825-0d9ef504fe4c":{"role":"reader","value":{"id":"4e6f7edd-4c2d-4936-b825-0d9ef504fe4c","version":1,"type":"numbered_list","properties":{"title":[["然后依次进入父目录，查找父目录下的 node_modules 目录"]]},"created_time":1673275148776,"last_edited_time":1673275148776,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"ae1ff4d9-7c5e-4056-b57e-62597791e0f7":{"role":"reader","value":{"id":"ae1ff4d9-7c5e-4056-b57e-62597791e0f7","version":1,"type":"numbered_list","properties":{"title":[["依次迭代，直到根目录下的 node_modules 目录"]]},"created_time":1673275148776,"last_edited_time":1673275148776,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"0f88bbb4-09eb-478f-82b8-4afd27185875":{"role":"reader","value":{"id":"0f88bbb4-09eb-478f-82b8-4afd27185875","version":1,"type":"text","properties":{"title":[["如下代码可以在 Node.js 的环境下使用，这个 module.path 就是查找的顺序"]]},"created_time":1673275148777,"last_edited_time":1673275148777,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"b087a35d-a1cf-4996-9e1f-ed8135f97531":{"role":"reader","value":{"id":"b087a35d-a1cf-4996-9e1f-ed8135f97531","version":6,"type":"code","properties":{"title":[["console.log(module.paths);\n// 输出\n[\n  \"/Users/hao/Work/github/node_module_test/node_modules\",\n  \"/Users/hao/Work/github/node_modules\",\n  \"/Users/hao/Work/node_modules\",\n  \"/Users/hao/node_modules\",\n  \"/Users/node_modules\",\n  \"/node_modules\",\n];"]],"language":[["JavaScript"]]},"format":{"code_wrap":true},"created_time":1673275148778,"last_edited_time":1673276322470,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"fa51b44b-7e34-431e-bf8c-786de50faaef":{"role":"reader","value":{"id":"fa51b44b-7e34-431e-bf8c-786de50faaef","version":1,"type":"text","properties":{"title":[["结合之前的图示，完整的策略为："]]},"created_time":1673275148778,"last_edited_time":1673275148778,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"3cc19901-3f7c-4ce2-96d3-c8959bb82ca7":{"role":"reader","value":{"id":"3cc19901-3f7c-4ce2-96d3-c8959bb82ca7","version":1,"type":"image","properties":{"source":[["https://static001.infoq.cn/resource/image/14/cb/1416ddabad3dcd4ffca600f88a7613cb.jpg"]]},"created_time":1673275148778,"last_edited_time":1673275148778,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"dda699e9-4ef6-4a3f-8e4e-6111c27001f2":{"role":"reader","value":{"id":"dda699e9-4ef6-4a3f-8e4e-6111c27001f2","version":1,"type":"text","properties":{"title":[["模块查找策略"]]},"created_time":1673275148779,"last_edited_time":1673275148779,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"57c4a920-8ce9-4dac-af59-83ac66f8738d":{"role":"reader","value":{"id":"57c4a920-8ce9-4dac-af59-83ac66f8738d","version":1,"type":"text","properties":{"title":[["简而言之，如果 require 绝对路径的文件，查找时不会去遍历每一个 node_modules 目录，其速度最快。其余流程如下："]]},"created_time":1673275148779,"last_edited_time":1673275148779,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"06447a0b-5296-4755-a20b-36c2d3f35633":{"role":"reader","value":{"id":"06447a0b-5296-4755-a20b-36c2d3f35633","version":1,"type":"numbered_list","properties":{"title":[["从 module path 数组中取出第一个目录作为查找基准。"]]},"created_time":1673275148780,"last_edited_time":1673275148780,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"8d160b62-edeb-4340-864f-e5ca60626a98":{"role":"reader","value":{"id":"8d160b62-edeb-4340-864f-e5ca60626a98","version":1,"type":"numbered_list","properties":{"title":[["直接从目录中查找该文件，如果存在，则结束查找。如果不存在，则进行下一条查找。"]]},"created_time":1673275148780,"last_edited_time":1673275148780,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"326555df-b10c-4efa-b6a0-73c02a6c602b":{"role":"reader","value":{"id":"326555df-b10c-4efa-b6a0-73c02a6c602b","version":1,"type":"numbered_list","properties":{"title":[["尝试添加.js、.json、.node 后缀后查找，如果存在文件，则结束查找。如果不存在，则进行下一条。"]]},"created_time":1673275148780,"last_edited_time":1673275148780,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"53b0ea32-9285-4098-a9dc-07270185c927":{"role":"reader","value":{"id":"53b0ea32-9285-4098-a9dc-07270185c927","version":1,"type":"numbered_list","properties":{"title":[["尝试将 require 的参数作为一个包来进行查找，读取目录下的 package.json 文件，取得 main 参数指定的文件。"]]},"created_time":1673275148780,"last_edited_time":1673275148780,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"1c73a8a4-7812-4b43-b448-aa8ee1568362":{"role":"reader","value":{"id":"1c73a8a4-7812-4b43-b448-aa8ee1568362","version":1,"type":"numbered_list","properties":{"title":[["尝试查找该文件，如果存在，则结束查找。如果不存在，则进行第 3 条查找。"]]},"created_time":1673275148780,"last_edited_time":1673275148780,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"6294c808-2da6-4932-abfe-cab16570126b":{"role":"reader","value":{"id":"6294c808-2da6-4932-abfe-cab16570126b","version":1,"type":"numbered_list","properties":{"title":[["如果继续失败，则取出 module path 数组中的下一个目录作为基准查找，循环第 1 至 5 个步骤。"]]},"created_time":1673275148780,"last_edited_time":1673275148780,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"4d4a6961-7a7e-43ca-9ed6-6d075218482b":{"role":"reader","value":{"id":"4d4a6961-7a7e-43ca-9ed6-6d075218482b","version":1,"type":"numbered_list","properties":{"title":[["如果继续失败，循环第 1 至 6 个步骤，直到 module path 中的最后一个值。"]]},"created_time":1673275148783,"last_edited_time":1673275148783,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"c6e4b4c1-983e-460a-853c-4bac0913a755":{"role":"reader","value":{"id":"c6e4b4c1-983e-460a-853c-4bac0913a755","version":1,"type":"numbered_list","properties":{"title":[["如果仍然失败，则抛出异常。"]]},"created_time":1673275148783,"last_edited_time":1673275148783,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"27656235-e903-4506-994b-38a87e33a790":{"role":"reader","value":{"id":"27656235-e903-4506-994b-38a87e33a790","version":1,"type":"text","properties":{"title":[["整个查找过程十分类似原型链的查找和作用域的查找。所幸 Node.js 对路径查找实现了缓存机制，否则由于每次判断路径都是同步阻塞式进行，会导致严重的性能消耗。"]]},"created_time":1673275148784,"last_edited_time":1673275148784,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"160e1304-f029-48ee-88a7-f9cbb88fc961":{"role":"reader","value":{"id":"160e1304-f029-48ee-88a7-f9cbb88fc961","version":1,"type":"sub_header","properties":{"title":[["CommonJs 包规范"]]},"created_time":1673275148784,"last_edited_time":1673275148784,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"5f6378de-867b-4f9c-801c-f43da0ecc6b0":{"role":"reader","value":{"id":"5f6378de-867b-4f9c-801c-f43da0ecc6b0","version":1,"type":"text","properties":{"title":[["一个符合 CommonJS 规范的包应该是如下这种结构："]]},"created_time":1673275148785,"last_edited_time":1673275148785,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"311cca20-3189-42a7-96af-f19a1d5fbcf0":{"role":"reader","value":{"id":"311cca20-3189-42a7-96af-f19a1d5fbcf0","version":1,"type":"numbered_list","properties":{"title":[["一个 package.json 文件应该存在于包顶级目录下"]]},"created_time":1673275148785,"last_edited_time":1673275148785,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"ec8b4fb0-9949-4d63-a720-0b3f3cd71978":{"role":"reader","value":{"id":"ec8b4fb0-9949-4d63-a720-0b3f3cd71978","version":1,"type":"numbered_list","properties":{"title":[["二进制文件应该包含在 bin 目录下。"]]},"created_time":1673275148786,"last_edited_time":1673275148786,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"045448c9-8e3d-4664-bd09-bcf83f31a176":{"role":"reader","value":{"id":"045448c9-8e3d-4664-bd09-bcf83f31a176","version":1,"type":"numbered_list","properties":{"title":[["JavaScript 代码应该包含在 lib 目录下。"]]},"created_time":1673275148786,"last_edited_time":1673275148786,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"2a62705f-8681-4a01-a804-e47a3931a21c":{"role":"reader","value":{"id":"2a62705f-8681-4a01-a804-e47a3931a21c","version":1,"type":"numbered_list","properties":{"title":[["文档应该在 doc 目录下。"]]},"created_time":1673275148786,"last_edited_time":1673275148786,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"78305cce-962c-4aaa-af22-f016c10e5451":{"role":"reader","value":{"id":"78305cce-962c-4aaa-af22-f016c10e5451","version":1,"type":"numbered_list","properties":{"title":[["单元测试应该在 test 目录下。"]]},"created_time":1673275148786,"last_edited_time":1673275148786,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"f39cd879-de44-4cd4-a0a4-8e14f2e85d69":{"role":"reader","value":{"id":"f39cd879-de44-4cd4-a0a4-8e14f2e85d69","version":1,"type":"text","properties":{"title":[["根据上文说的查找逻辑，其实很重要的一点就是 package.json 里的 main 字段。 这个定义了包的入口文件所在。"]]},"created_time":1673275148787,"last_edited_time":1673275148787,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"eacc1bf1-569c-4a2e-8451-dc3d9929e827":{"role":"reader","value":{"id":"eacc1bf1-569c-4a2e-8451-dc3d9929e827","version":1,"type":"sub_header","properties":{"title":[["为何有些模块可以在 Node.js 运行也可以在浏览器端运行"]]},"created_time":1673275148787,"last_edited_time":1673275148787,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"827ab5ed-0a81-4504-af65-6f6b1a8e2df3":{"role":"reader","value":{"id":"827ab5ed-0a81-4504-af65-6f6b1a8e2df3","version":1,"type":"text","properties":{"title":[["浏览器端的 Js 代码都是通过 script 标签引入并执行。"]]},"created_time":1673275148788,"last_edited_time":1673275148788,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"0dc040c3-a844-49ce-95b8-ca5687cd3bd3":{"role":"reader","value":{"id":"0dc040c3-a844-49ce-95b8-ca5687cd3bd3","version":1,"type":"text","properties":{"title":[["Node.js 是会通过上文中提到的闭包函数去进行包装"]]},"created_time":1673275148788,"last_edited_time":1673275148788,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"6d28e0fa-7cc7-481a-a386-32cd857d9e2b":{"role":"reader","value":{"id":"6d28e0fa-7cc7-481a-a386-32cd857d9e2b","version":14,"type":"code","properties":{"title":[["(function (exports, require, module, __filename, __dirname) {\n  // Your file content\n});"]],"language":[["JavaScript"]]},"format":{"code_wrap":true},"created_time":1673275148789,"last_edited_time":1673276338192,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"639fcc6e-55bb-44d1-84a4-c34a5301d05b":{"role":"reader","value":{"id":"639fcc6e-55bb-44d1-84a4-c34a5301d05b","version":1,"type":"text","properties":{"title":[["Node.js 由于是个闭包，所以不会污染全局变量。浏览器端则不然。 有些包可以在 Node.js 和浏览器端运行，也是利用闭包和变量检测去完成模块的解析和运行的。 例如著名类库 underscore 的定义方式"]]},"created_time":1673275148789,"last_edited_time":1673275148789,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"271821ef-6cee-42a0-8efb-244c189e6799":{"role":"reader","value":{"id":"271821ef-6cee-42a0-8efb-244c189e6799","version":6,"type":"code","properties":{"title":[["(function () {\n  // Establish the root object, `window` in the browser, or `global` on the server.\n  var root = this;\n  var _ = function (obj) {\n    return new wrapper(obj);\n  };\n  if (typeof exports !== \"undefined\") {\n    if (typeof module !== \"undefined\" \u0026\u0026 module.exports) {\n      exports = module.exports = _;\n    }\n    exports._ = _;\n  } else if (typeof define === \"function\" \u0026\u0026 define.amd) {\n    // Register as a named module with AMD.\n    define(\"underscore\", function () {\n      return _;\n    });\n  } else {\n    root[\"_\"] = _;\n  }\n}.call(this));"]],"language":[["JavaScript"]]},"format":{"code_wrap":true},"created_time":1673275148790,"last_edited_time":1673276344497,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"be99dc4c-b9c0-49e4-998f-e2d29240e05f":{"role":"reader","value":{"id":"be99dc4c-b9c0-49e4-998f-e2d29240e05f","version":1,"type":"text","properties":{"title":[["以上代码优先检测了 exports 是否存在，也就是 CommonJs 规范，如果存在 exports 对象，直接将目标对象定义在 exports 上。"]]},"created_time":1673275148791,"last_edited_time":1673275148791,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"33465ab9-8acb-45f6-af41-13ed7d48e3a1":{"role":"reader","value":{"id":"33465ab9-8acb-45f6-af41-13ed7d48e3a1","version":1,"type":"text","properties":{"title":[["然后检测了 define 是否存在，这是 amd 的模块规范，以适配 amd 的模块规范。"]]},"created_time":1673275148793,"last_edited_time":1673275148793,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"87a056e9-c289-4661-96c7-09a946ff8809":{"role":"reader","value":{"id":"87a056e9-c289-4661-96c7-09a946ff8809","version":1,"type":"text","properties":{"title":[["最终如果检测不到 CommonJs 和 AMD 的运行环境，则认为是在一个沙盒内运行。"]]},"created_time":1673275148794,"last_edited_time":1673275148794,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"46ded542-9547-4906-8bcb-806b1f3300b1":{"role":"reader","value":{"id":"46ded542-9547-4906-8bcb-806b1f3300b1","version":1,"type":"text","properties":{"title":[["可以看到第一行的"],["var root = this",[["c"]]],["，这个 this 在浏览器端即为 window。也就是说如果运行环境既不是 CommmonJs 也不是 AMD，则直接挂在 window 对象下。"]]},"created_time":1673275148795,"last_edited_time":1673275148795,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"ea519ed1-92ca-4bdf-a8ce-f6bc509763e5":{"role":"reader","value":{"id":"ea519ed1-92ca-4bdf-a8ce-f6bc509763e5","version":1,"type":"text","properties":{"title":[["现在很多的打包工具都会根据打包的 target（UMD, CommonJs 等）进行 build, 会自动的拼接这些判断，所以其实日常开发 js 插件/模块，是不需要担心这些环境检测的代码的。"]]},"created_time":1673275148795,"last_edited_time":1673275148795,"parent_id":"129181e5-5b2d-40a5-af60-47c125f075fd","parent_table":"block","alive":true,"ignore_block_count":true,"created_by_table":"notion_user","created_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","last_edited_by_table":"notion_user","last_edited_by_id":"655f56a9-2482-4fed-ae6d-9f23ccbb923a","space_id":"11f66c5f-6043-406b-b492-4dc267645668"}}},"collection":{"7c5b4e39-cf12-4d8c-986c-cff290eee407":{"role":"reader","value":{"id":"7c5b4e39-cf12-4d8c-986c-cff290eee407","version":47,"name":[["Posts"]],"schema":{";nHF":{"name":"Created time","type":"created_time"},"\u003e:DV":{"name":"Published","type":"checkbox"},"VeZ_":{"name":"Private","type":"checkbox"},"Zq\u003e}":{"name":"Featured","type":"checkbox"},"rTD}":{"name":"Tags","type":"multi_select","options":[{"id":"33b90624-5bb0-463f-b4e6-43a173ffe028","color":"pink","value":"Life"}]},"s?]n":{"name":"Last edited time","type":"last_edited_time"},"title":{"name":"Title","type":"title"}},"cover":"/images/page-cover/solid_beige.png","format":{"property_visibility":[{"property":"rTD}","visibility":"hide"},{"property":";nHF","visibility":"hide"},{"property":"Zq\u003e}","visibility":"hide"},{"property":"s?]n","visibility":"hide"},{"property":"VeZ_","visibility":"hide"},{"property":"\u003e:DV","visibility":"hide"}],"collection_cover_position":0.5,"collection_page_properties":[{"visible":true,"property":"rTD}"}]},"parent_id":"720fa796-e2d6-42db-ac52-1fee3d19addd","parent_table":"block","alive":true,"migrated":true,"space_id":"11f66c5f-6043-406b-b492-4dc267645668","deleted_schema":{"ElLO":{"name":"Date","type":"date"},"KJ}\\":{"name":"Created time 1","type":"created_time"},"_}UF":{"name":"Date","type":"date"}}}}},"collection_view":{"97e7d4c0-30d1-4f1c-a393-bb0306148ce7":{"role":"reader","value":{"id":"97e7d4c0-30d1-4f1c-a393-bb0306148ce7","version":4,"type":"gallery","name":"Featured","format":{"gallery_cover":{"type":"page_cover"},"property_filters":[{"id":"76d07a2c-1674-4c5e-9a09-84428c965a95","filter":{"filter":{"value":{"type":"exact","value":true},"operator":"checkbox_is"},"property":"Zq\u003e}"}}],"hide_linked_collection_name":true},"parent_id":"720fa796-e2d6-42db-ac52-1fee3d19addd","parent_table":"block","alive":true,"page_sort":["19be9c2d-64ff-4c8a-8135-571eb833f289","2d0a5101-7003-4092-9057-19b8afad5b47","f035a5d3-a3cc-4c7f-a807-1ef1adf3d793","549e0e14-1265-41ed-b0e8-6cd266e689f0","2cabcd1c-9b22-40e5-ac11-49c6807ab8f7","39be2719-fb58-49f3-a7fc-6d1c9ca86757","5d2d521a-e821-4acd-b0db-1e0ace950295","129181e5-5b2d-40a5-af60-47c125f075fd","455dfe03-94f5-4179-a5d7-528c072d34c4","08afc86f-001a-4e35-a008-dae3063a0609","a77bb6e8-2578-4904-9083-86ecf9c1f0a7","0325ef1f-7bf7-47c3-9337-846fb5f115d1","e061616a-52e8-4895-bd2f-49c89f9c1955","90521391-4623-4551-b800-b337c6a1a061","82caae75-4984-4c43-859e-3a6fe07a31ca","ddb18a21-3c29-4770-9c25-4f7796632bb1","bdb4410f-b5e7-4e79-9d1e-68e2a64fe6e9","48df005d-f436-494a-921f-ad2be3388574","5a474382-e7cf-4ad9-8f12-e9a1bd2070a2","62c87db4-45b4-4366-8554-381f50f2f311","4963aee5-ffc5-4331-aff7-1a1e7f0c1aa9","5c17239d-019d-4ccf-8548-27cfa3c3d914","859a952e-c177-4636-8562-cb1663774fc2","143aa995-a6e5-4b83-b563-7caa81bc1927","7e233de2-23bc-4f0c-901c-4d575de8d41f","983ee778-1ecd-4f7d-a4ac-8c6414650094","23146840-d749-41b1-b8df-523c80c97f44","5d69ef31-acbb-41f1-bf02-ee223b7c3861","f88d2799-5621-41eb-92b0-27a14fef0ecf","cedc02cb-5096-4bbc-894e-279f88496648","29a3efb4-d59c-461a-939d-9732c7f1a467","a8ee382f-e2b1-4b9a-ade7-2375e182b3fd","c64bde7c-b595-43be-8d49-9b2218059933","5923a11f-5dc9-4905-87ca-5da3810c4806"],"space_id":"11f66c5f-6043-406b-b492-4dc267645668"}},"c5d58f05-b0cc-4b2b-b545-f1fd5df549fb":{"role":"reader","value":{"id":"c5d58f05-b0cc-4b2b-b545-f1fd5df549fb","version":38,"type":"table","name":"Table","format":{"table_properties":[{"width":455,"visible":true,"property":"title"},{"width":200,"visible":false,"property":";nHF"},{"width":200,"visible":false,"property":"Zq\u003e}"},{"width":200,"visible":false,"property":"s?]n"},{"width":200,"visible":false,"property":"VeZ_"},{"width":200,"visible":false,"property":"\u003e:DV"},{"width":200,"visible":false,"property":"rTD}"}]},"parent_id":"720fa796-e2d6-42db-ac52-1fee3d19addd","parent_table":"block","alive":true,"page_sort":["2d0a5101-7003-4092-9057-19b8afad5b47","549e0e14-1265-41ed-b0e8-6cd266e689f0","2cabcd1c-9b22-40e5-ac11-49c6807ab8f7","39be2719-fb58-49f3-a7fc-6d1c9ca86757","5d2d521a-e821-4acd-b0db-1e0ace950295","129181e5-5b2d-40a5-af60-47c125f075fd","455dfe03-94f5-4179-a5d7-528c072d34c4","08afc86f-001a-4e35-a008-dae3063a0609","a77bb6e8-2578-4904-9083-86ecf9c1f0a7","0325ef1f-7bf7-47c3-9337-846fb5f115d1","e061616a-52e8-4895-bd2f-49c89f9c1955","90521391-4623-4551-b800-b337c6a1a061","ddb18a21-3c29-4770-9c25-4f7796632bb1","bdb4410f-b5e7-4e79-9d1e-68e2a64fe6e9","48df005d-f436-494a-921f-ad2be3388574","5a474382-e7cf-4ad9-8f12-e9a1bd2070a2","62c87db4-45b4-4366-8554-381f50f2f311","4963aee5-ffc5-4331-aff7-1a1e7f0c1aa9","5c17239d-019d-4ccf-8548-27cfa3c3d914","859a952e-c177-4636-8562-cb1663774fc2","143aa995-a6e5-4b83-b563-7caa81bc1927","7e233de2-23bc-4f0c-901c-4d575de8d41f","983ee778-1ecd-4f7d-a4ac-8c6414650094","23146840-d749-41b1-b8df-523c80c97f44","5d69ef31-acbb-41f1-bf02-ee223b7c3861","f88d2799-5621-41eb-92b0-27a14fef0ecf","cedc02cb-5096-4bbc-894e-279f88496648","29a3efb4-d59c-461a-939d-9732c7f1a467","a8ee382f-e2b1-4b9a-ade7-2375e182b3fd","c64bde7c-b595-43be-8d49-9b2218059933","5923a11f-5dc9-4905-87ca-5da3810c4806","19be9c2d-64ff-4c8a-8135-571eb833f289","f035a5d3-a3cc-4c7f-a807-1ef1adf3d793"],"space_id":"11f66c5f-6043-406b-b492-4dc267645668"}}},"space":{},"notion_user":{},"collection_query":{},"signed_urls":{}}},"__N_SSG":true},"page":"/[pageId]","query":{"pageId":"129181e55b2d40a5af6047c125f075fd"},"buildId":"LPY4J0ojF6qd7z1Lg7Iy6","assetPrefix":"/blog","runtimeConfig":{"basePath":"/blog"},"isFallback":false,"dynamicIds":[2679,8785],"gsp":true,"scriptLoader":[]}</script></body></html>