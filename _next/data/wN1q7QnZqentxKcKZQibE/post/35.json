{"pageProps":{"html":"<h1 dir=\"auto\">ä½¿ç”¨ Github Action è‡ªåŠ¨å‘å¸ƒ npm åŒ…</h1>\n<h2 dir=\"auto\">ç®€ä»‹</h2>\n<p dir=\"auto\">ä¸‹åˆæŠ½ç©ºè°ƒç ”äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ github action æ¥è‡ªåŠ¨å‘å¸ƒ npm åŒ…ã€‚å†™ä¸‹æœ¬æ–‡è®°å½•ã€‚</p>\n<h2 dir=\"auto\">æ­¥éª¤</h2>\n<ul dir=\"auto\">\n<li>å‡†å¤‡ npm token</li>\n<li>è®¾ç½® github secret</li>\n<li>è®¾ç½® github actions</li>\n</ul>\n<h2 dir=\"auto\">å‡†å¤‡ npm token</h2>\n<ul dir=\"auto\">\n<li>è®¿é—®<a href=\"https://www.npmjs.com/\" rel=\"nofollow\">https://www.npmjs.com/</a> å¹¶ç™»å½•ã€‚</li>\n<li>è¿›å…¥ä¸ªäººè®¾ç½® - access tokensã€‚</li>\n<li>é€‰æ‹©<code class=\"notranslate\">Generate New Token</code>ï¼Œè¾“å…¥å¯†ç ç¡®è®¤ã€‚</li>\n<li>ç»™è¯¥ token èµ·ä¸ªåå­—(åå­—ä¸å½±å“ï¼Œä¸ºäº†æ–¹ä¾¿è®°å¿†å¯ä»¥ä½¿ç”¨<code class=\"notranslate\">npm_publish</code>è¿™ç§)ã€‚å¹¶è®¾ç½® token ç±»å‹ä¸º<code class=\"notranslate\">Automation</code></li>\n<li>è®°ä¸‹è¯¥ tokenã€‚</li>\n</ul>\n<h2 dir=\"auto\">è®¾ç½® github secret</h2>\n<ul dir=\"auto\">\n<li>è¿›å…¥ github ä»“åº“ã€‚</li>\n<li>ç‚¹å‡»ä»“åº“çš„<code class=\"notranslate\">Settings - Actions</code>ï¼Œç‚¹å‡»å³ä¸Šè§’çš„<code class=\"notranslate\">New Repository Secret</code></li>\n<li>è¾“å…¥ Token åç§°ï¼Œä¾‹å¦‚<code class=\"notranslate\">NPM_PUBLISH_TOKEN</code>, å¹¶å¡«å…¥ä¹‹å‰åœ¨ npmjs.com ä¸Šåˆ›å»ºçš„ npm token</li>\n</ul>\n<h2 dir=\"auto\">è®¾ç½® github actions</h2>\n<ul dir=\"auto\">\n<li>åœ¨ä»“åº“å†…æ–°å»º<code class=\"notranslate\">.github/workflows/publish.yml</code>æ–‡ä»¶</li>\n<li>æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</li>\n</ul>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"name: Publish to NPM\non:\n  # releaseæ—¶è§¦å‘ã€‚\n  release:\n    types: [created]\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v3\n      - name: Setup Node\n        uses: actions/setup-node@v3\n        with:\n          node-version: 16\n      # å› ä¸ºæˆ‘çš„ä»“åº“ä½¿ç”¨çš„æ˜¯pnpmï¼Œæ‰€ä»¥éœ€è¦å®‰è£…pnpm, è‹¥ä½¿ç”¨çš„æ˜¯npmåˆ™å¯ä»¥å¿½ç•¥ã€‚\n      - name: Install Pnpm\n        uses: pnpm/action-setup@v2.2.2\n        with:\n          version: 6.0.2\n      # å®‰è£…ä¾èµ–ï¼Œè„šæœ¬(runéƒ¨åˆ†)å¯ä»¥è‡ªå·±å†™\n      - name: Install dependencies\n        run: pnpm install\n      # å¯ä»¥ä½¿ç”¨prepublishOnlyæ¥åšbuild, è¿™æ ·buildå¯ä»¥åœ¨ciç¯èŠ‚ä¸­å‰”é™¤ã€‚è§ä¸‹æ–‡Tips\n      - name: Build\n        run: pnpm run build\n      # ä½¿ç”¨JS-DevTools/npm-publish@v1æ¥è¿›è¡Œnpmå‘å¸ƒã€‚\n      - name: Publish package on NPM ğŸ“¦\n        uses: JS-DevTools/npm-publish@v1\n        with:\n          # tokené‡Œçš„secrets.NPM_PUBLISH_TOKENå°±æ˜¯åœ¨ä»“åº“å†…è®¾å®šçš„tokenåã€‚\n          token: ${{ secrets.NPM_PUBLISH_TOKEN }}\"><pre class=\"notranslate\"><span class=\"pl-ent\">name</span>: <span class=\"pl-s\">Publish to NPM</span>\n<span class=\"pl-ent\">on</span>:\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> releaseæ—¶è§¦å‘ã€‚</span>\n  <span class=\"pl-ent\">release</span>:\n    <span class=\"pl-ent\">types</span>: <span class=\"pl-s\">[created]</span>\n<span class=\"pl-ent\">jobs</span>:\n  <span class=\"pl-ent\">build</span>:\n    <span class=\"pl-ent\">runs-on</span>: <span class=\"pl-s\">ubuntu-latest</span>\n    <span class=\"pl-ent\">steps</span>:\n      - <span class=\"pl-ent\">name</span>: <span class=\"pl-s\">Checkout</span>\n        <span class=\"pl-ent\">uses</span>: <span class=\"pl-s\">actions/checkout@v3</span>\n      - <span class=\"pl-ent\">name</span>: <span class=\"pl-s\">Setup Node</span>\n        <span class=\"pl-ent\">uses</span>: <span class=\"pl-s\">actions/setup-node@v3</span>\n        <span class=\"pl-ent\">with</span>:\n          <span class=\"pl-ent\">node-version</span>: <span class=\"pl-c1\">16</span>\n      <span class=\"pl-c\"><span class=\"pl-c\">#</span> å› ä¸ºæˆ‘çš„ä»“åº“ä½¿ç”¨çš„æ˜¯pnpmï¼Œæ‰€ä»¥éœ€è¦å®‰è£…pnpm, è‹¥ä½¿ç”¨çš„æ˜¯npmåˆ™å¯ä»¥å¿½ç•¥ã€‚</span>\n      - <span class=\"pl-ent\">name</span>: <span class=\"pl-s\">Install Pnpm</span>\n        <span class=\"pl-ent\">uses</span>: <span class=\"pl-s\">pnpm/action-setup@v2.2.2</span>\n        <span class=\"pl-ent\">with</span>:\n          <span class=\"pl-ent\">version</span>: <span class=\"pl-s\">6.0.2</span>\n      <span class=\"pl-c\"><span class=\"pl-c\">#</span> å®‰è£…ä¾èµ–ï¼Œè„šæœ¬(runéƒ¨åˆ†)å¯ä»¥è‡ªå·±å†™</span>\n      - <span class=\"pl-ent\">name</span>: <span class=\"pl-s\">Install dependencies</span>\n        <span class=\"pl-ent\">run</span>: <span class=\"pl-s\">pnpm install</span>\n      <span class=\"pl-c\"><span class=\"pl-c\">#</span> å¯ä»¥ä½¿ç”¨prepublishOnlyæ¥åšbuild, è¿™æ ·buildå¯ä»¥åœ¨ciç¯èŠ‚ä¸­å‰”é™¤ã€‚è§ä¸‹æ–‡Tips</span>\n      - <span class=\"pl-ent\">name</span>: <span class=\"pl-s\">Build</span>\n        <span class=\"pl-ent\">run</span>: <span class=\"pl-s\">pnpm run build</span>\n      <span class=\"pl-c\"><span class=\"pl-c\">#</span> ä½¿ç”¨JS-DevTools/npm-publish@v1æ¥è¿›è¡Œnpmå‘å¸ƒã€‚</span>\n      - <span class=\"pl-ent\">name</span>: <span class=\"pl-s\">Publish package on NPM ğŸ“¦</span>\n        <span class=\"pl-ent\">uses</span>: <span class=\"pl-s\">JS-DevTools/npm-publish@v1</span>\n        <span class=\"pl-ent\">with</span>:\n          <span class=\"pl-c\"><span class=\"pl-c\">#</span> tokené‡Œçš„secrets.NPM_PUBLISH_TOKENå°±æ˜¯åœ¨ä»“åº“å†…è®¾å®šçš„tokenåã€‚</span>\n          <span class=\"pl-ent\">token</span>: <span class=\"pl-s\">${{ secrets.NPM_PUBLISH_TOKEN }}</span></pre></div>\n<h2 dir=\"auto\">æµ‹è¯•ä½¿ç”¨</h2>\n<p dir=\"auto\">åœ¨ github ä»“åº“çš„<code class=\"notranslate\">Releases</code>é¡µé¢ç‚¹å‡»<code class=\"notranslate\">Draft a new release</code><br>\nåœ¨ä¸€ä¸ª release å‘å¸ƒåï¼Œä¼šè‡ªåŠ¨è§¦å‘ä¸Šæ–‡è®¾ç½®çš„ github actionã€‚</p>\n<h2 dir=\"auto\">Tips</h2>\n<ul dir=\"auto\">\n<li>å¦‚æœåœ¨<code class=\"notranslate\">package.json</code>ä¸­è®¾ç½®äº† <code class=\"notranslate\">prepublishOnly</code>é’©å­å»è¿›è¡Œ<code class=\"notranslate\">build</code>æ“ä½œï¼Œå°±æ— éœ€åœ¨ action ä¸­é…ç½®<code class=\"notranslate\">npm run build</code>ç¯èŠ‚äº†ã€‚</li>\n</ul>\n<h2 dir=\"auto\">Examples</h2>\n<p dir=\"auto\">å‚è€ƒï¼š<a href=\"https://github.com/phshy0607/test-ci-auto-publish\">https://github.com/phshy0607/test-ci-auto-publish</a></p>"},"__N_SSG":true}